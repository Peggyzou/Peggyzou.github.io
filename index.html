<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-浏览器渲染" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/08/30/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93/" class="article-date">
  <time datetime="2023-08-30T11:53:55.000Z" itemprop="datePublished">2023-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/08/30/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93/">浏览器渲染</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="浏览器内核"><a href="#浏览器内核" class="headerlink" title="浏览器内核"></a>浏览器内核</h1><p>浏览器内核主要分成两部分：</p>
<p>渲染引擎：职责就是渲染，即在浏览器窗口中显示所请求的内容。默认情况下，渲染引擎可以显示 html、xml 文档及图片，它也可以借助插件显示其他类型数据，例如使用 PDF 阅读器插件，可以显示 PDF 格式。</p>
<p>JS 引擎：解析和执行 javascript 来实现网页的动态效果。</p>
<p>最开始渲染引擎和 JS 引擎并没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</p>
<h1 id="浏览器渲染过程"><a href="#浏览器渲染过程" class="headerlink" title="浏览器渲染过程"></a>浏览器渲染过程</h1><ol>
<li>首先解析收到的文档，根据文档定义构建一棵 DOM 树，DOM 树是由 DOM 元素及属性节点组成的。</li>
</ol>
<p><img src="1.png" alt="1693397452036"></p>
<ol start="2">
<li>对 CSS 进行解析，生成 CSSOM 规则树。</li>
</ol>
<p>在解析的过程中，如果遇到CSS的link元素，那么会由浏览器负责下载对应的CSS文件。 <code>注意：下载CSS文件是不会影响DOM的解析的；</code>浏览器下载完CSS文件后，就会对CSS文件进行解析，解析出对应的规则树，我们可以称之为 CSSOM（CSS Object Model，CSS对象模型）；</p>
<p><img src="2.png" alt="1693398076262"></p>
<ol start="3">
<li>根据 DOM 树和 CSSOM 规则树构建渲染树。</li>
</ol>
<p>渲染树的节点被称为渲染对象，渲染对象是一个包含有颜色和大小等属性的矩形，渲染对象和 DOM 元素相对应，但这种对应关系不是一对一的，不可见的 DOM 元素不会被插入渲染树。还有一些 DOM元素对应几个可见对象，它们一般是一些具有复杂结构的元素，无法用一个矩形来描述。</p>
<p><img src="3.png" alt="1693398229799"></p>
<p><code>注意：link元素不会阻塞DOM Tree的构建过程，但是会阻塞Render Tree的构建过程</code>，这是因为Render Tree在构建时，需要对应的CSSOM Tree。</p>
<p>当渲染对象被创建并添加到树中，它们并没有位置和大小，所以当浏览器生成渲染树以后，就会根据渲染树来进行布局（也可以叫做回流）。这一阶段浏览器要做的事情是要弄清楚各个节点在页面中的确切宽度、高度和位置信息，通常这一行为也被称为“自动重排”。</p>
<p>布局阶段结束后是绘制阶段，遍历渲染树并调用渲染对象的 paint 方法将它们的内容显示在屏幕上，绘制使用 UI 基础组件。</p>
<ul>
<li>在绘制阶段，浏览器将布局阶段计算的每个frame转为屏幕上实际的像素点；</li>
<li>包括将元素的可见部分进行绘制，比如文本、颜色、边框、阴影、替换元素（比如img）。</li>
</ul>
<p><img src="4.png" alt="1693400190162"></p>
<p>大致过程：</p>
<p><img src="5.jpeg" alt="1693400357976"></p>
<p><code>注意：这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html 都解析完成之后再去构建和布局 render 树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。</code></p>
<h1 id="回流-重绘-合成"><a href="#回流-重绘-合成" class="headerlink" title="回流-重绘-合成"></a>回流-重绘-合成</h1><ol>
<li>回流</li>
</ol>
<p>另一个叫法是重排，回流触发的条件就是：对DOM结构的修改引发DOM几何尺寸的变化的时候，会发生回流过程。</p>
<p>具体有以下的操作会触发回流：</p>
<ul>
<li>一个DOM元素的几何属性变化，常见的几何属性有width、height、padding、margin、left、top、border等</li>
<li>使DOM节点发生增减或者移动</li>
<li>窗口resize（修改了窗口的尺寸等）</li>
<li>调用getComputedStyle方法获取尺寸、位置信息</li>
<li>读写offset族、scroll族和client族属性的时候，浏览器为了获取这些值，需要进行回流操作。</li>
</ul>
<p>一些常用且会导致回流的属性和方法：</p>
<ul>
<li>调用window。getComputedStyle方法</li>
<li>clientWidth、clientHeight、clientTop、clientLeft</li>
<li>offsetWidth、offsetHeight、offsetTop、offsetLeft</li>
<li>scrollWidth、scrollHeight、scrollTop、scrollLeft</li>
<li>scrollIntoView()、scrollIntoViewIfNeeded()</li>
<li>getComputedStyle()</li>
<li>getBoundingClientRect()</li>
<li>scrollTo()</li>
</ul>
<ol start="2">
<li>重绘</li>
</ol>
<p>当页面中元素样式的改变并不影响它在文档流中的位置时（例如：color、background-color、visibility等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</p>
<p>根据概念，我们知道由于没有导致 DOM 几何属性的变化，因此元素的位置信息不需要更新，从而省去布局的过程。</p>
<p>具体有以下的操作会触发重绘：</p>
<p>比如修改背景色、文字颜色、边框颜色、样式等；</p>
<p><code>重绘不一定导致回流，但回流一定发生了重绘，所以回流是一很消耗性能的事情。</code></p>
<ol start="3">
<li>composite合成</li>
</ol>
<p>还有一种情况：就是更改了一个既不要布局也不要绘制的属性，那么渲染引擎会跳过布局和绘制，直接执行后续的合成操作，这个过程就叫合成。</p>
<p>举个例子：比如使用CSS的transform来实现动画效果，避免了回流跟重绘，直接在非主线程中执行合成动画操作。显然这样子的效率更高，毕竟这个是在非主线程上合成的，没有占用主线程资源，另外也避开了布局和绘制两个子阶段，所以相对于重绘和重排，合成能大大提升绘制效率。</p>
<p>默认情况下，标准流中的内容都是被绘制在同一个图层（Layer）中的；而一些特殊的属性，会创建一个新的合成（CompositingLayer ），并且新的图层可以利用GPU来加速绘制，因为每个合成层都是单独渲染的。</p>
<p>常见可以形成新的合成层的属性：</p>
<ul>
<li>3D transforms</li>
<li>video、canvas、iframe</li>
<li>opacity 动画转换时</li>
<li>position: fixed</li>
<li>will-change：一个实验性的属性，提前告诉浏览器元素可能发生哪些变化</li>
<li>animation 或 transition 设置了opacity、transform</li>
</ul>
<h1 id="浏览器渲染优化"><a href="#浏览器渲染优化" class="headerlink" title="浏览器渲染优化"></a>浏览器渲染优化</h1><ol>
<li>针对JavaScript</li>
</ol>
<p>JavaScript既会阻塞HTML的解析，也会阻塞CSS的解析。因此我们可以对JavaScript的加载方式进行改变，来进行优化：</p>
<ul>
<li>尽量将JavaScript文件放在body的最后</li>
<li>body中间尽量不要写 <code>&lt;script&gt;</code>标签</li>
<li><code>&lt;script&gt;</code>标签的引入资源方式有三种，有一种就是我们常用的直接引入，还有两种就是使用 async 属性和 defer 属性来异步引入，两者都是去异步加载外部的JS文件，不会阻塞DOM的解析（尽量使用异步加载）。三者的区别如下：<br>（1）script 立即停止页面渲染去加载资源文件，当资源加载完毕后立即执行js代码，js代码执行完毕后继续渲染页面。<br>（2）async 是在下载完成之后，立即异步加载，加载好后立即执行，多个带async属性的标签，不能保证加载的顺序。<br>（3）defer 是在下载完成之后，立即异步加载。加载好后，如果 DOM 树还没构建好，则先等 DOM 树解析好再执行；如果DOM树已经准备好，则立即执行。多个带defer属性的标签，按照顺序执行。</li>
</ul>
<ol start="2">
<li>针对CSS</li>
</ol>
<p>css要放在顶部，它不会阻塞html的解析</p>
<p>使用CSS有三种方式：使用link、@import、内联样式，其中link和@import都是导入外部样式。它们之间的区别：</p>
<p>link：浏览器会派发一个新的线程(HTTP线程)去加载资源文件，与此同时GUI渲染线程会继续向下渲染代码</p>
<p>@import：GUI渲染线程会暂时停止渲染，去服务器加载资源文件，资源文件没有返回之前不会继续渲染(阻碍浏览器渲染)</p>
<p>style：GUI直接渲染</p>
<p>外部样式如果长时间没有加载完毕，浏览器为了用户体验，会使用浏览器会默认样式，确保首次渲染的速度。所以CSS一般写在head中，让浏览器尽快发送请求去获取css样式。</p>
<p>所以，在开发过程中，导入外部样式使用link，而不用@import。如果css少，尽可能采用内嵌样式，直接写在style标签中。</p>
<p><strong>style样式解析</strong><br>style中的样式不解析完毕，页面不会渲染。</p>
<ul>
<li>由html解析器解析</li>
<li>不会阻塞浏览器渲染，但可能出现闪屏现象</li>
<li>不会阻塞DOM解析</li>
</ul>
<p>通过style标签引入会一般解析，一边渲染。</p>
<p><strong>link引入</strong></p>
<ul>
<li>link进来的样式，由css解析器去解析，并且是同步解析的。</li>
<li>css解析器会阻塞页面的渲染。(link引入的外部样式会阻塞页面渲染，可以利用这种阻塞避免”闪屏现象”)</li>
<li>推荐使用link引入样式。</li>
<li>阻塞后面的js语句的执行</li>
</ul>
<ol start="3">
<li>针对DOM树、CSSOM树</li>
</ol>
<p>可以通过以下几种方式来减少渲染的时间：</p>
<ul>
<li>HTML文件的代码层级尽量不要太深</li>
<li>使用语义化的标签，来避免不标准语义化的特殊处理</li>
<li>减少CSSD代码的层级，因为选择器是从左向右进行解析的</li>
</ul>
<ol start="4">
<li>减少回流和重绘</li>
</ol>
<ul>
<li>操作DOM时，尽量在低层级的DOM节点进行操作</li>
<li>不要使用table布局， 一个小的改动可能会使整个table进行重新布局</li>
<li>使用CSS的表达式</li>
<li>不要频繁操作元素的样式，对于静态页面，可以修改类名，而不是样式。</li>
<li>使用absolute或者fixed，使元素脱离文档流，这样他们发生变化就不会影响其他元素</li>
<li>避免频繁操作DOM，可以创建一个文档片段documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中</li>
<li>将元素先设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。</li>
<li>将DOM的多个读操作（或者写操作）放在一起，而不是读写操作穿插着写。这得益于浏览器的渲染队列机制。</li>
<li>浏览器针对页面的回流与重绘，进行了自身的优化——渲染队列</li>
</ul>
<p>浏览器会将所有的回流、重绘的操作放在一个队列中，当队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会对队列进行批处理。这样就会让多次的回流、重绘变成一次回流重绘。</p>
<p>将多个读操作（或者写操作）放在一起，就会等所有的读操作进入队列之后执行，这样，原本应该是触发多次回流，变成了只触发一次回流。</p>
<ol start="5">
<li>defer和async属性</li>
</ol>
<p><strong>derfer</strong><br>defer 属性告诉浏览器不要等待脚本下载，而继续解析HTML，构建DOM Tree。</p>
<p>脚本会由浏览器来进行下载，但是不会阻塞DOM Tree的构建过程；如果脚本提前下载好了，它会等待DOM Tree构建完成，在DOMContentLoaded事件之前先执行defer中的代码；另外多个带defer的脚本是可以保持正确的顺序执行的。 从某种角度来说，defer可以提高页面的性能，并且推荐放到head元素中；<br><code>注意：defer仅适用于外部脚本，对于script默认内容会被忽略</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">defer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>async</strong><br>async 特性与 defer 有些类似，它也能够让脚本不阻塞页面。async是让一个脚本完全独立的：</p>
<p>浏览器不会因 async 脚本而阻塞（与 defer 类似），但async脚本不能保证顺序，它是独立下载、独立运行，不会等待其他脚本；async不能保证在DOMContentLoaded之前或者之后执行；</p>
<ul>
<li>defer通常用于需要在文档解析后操作DOM的JavaScript代码，并且对多个script文件有顺序要求的；</li>
<li>async通常用于独立的脚本，对其他脚本，甚至DOM没有依赖的；</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/08/30/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93/" data-id="clm52imw50013c4wpeytmfgml" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-typescript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/08/13/typescript/" class="article-date">
  <time datetime="2023-08-13T02:08:39.000Z" itemprop="datePublished">2023-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/08/13/typescript/">typescript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="TS简介"><a href="#TS简介" class="headerlink" title="TS简介"></a>TS简介</h2><p>TypeScript 是一种由微软开发的自由和开源的编程语言。它是 JavaScript 的一个超集，而且本质上向这个语言添加了可选的静态类型和基于类的面向对象编程。它扩展了 JavaScript 的语法，所以任何现有的 JavaScript 程序可以不加改变的在 TypeScript 下工作。TypeScript 是为大型应用之开发而设计，而编译时它产生 JavaScript 以确保兼容性。</p>
<h2 id="TypeScript-与-JavaScript-的区别"><a href="#TypeScript-与-JavaScript-的区别" class="headerlink" title="TypeScript 与 JavaScript 的区别"></a><strong>TypeScript 与 JavaScript 的区别</strong></h2><ol>
<li>TypeScript 是 JavaScript 的超集，扩展了 JavaScript 的语法。</li>
<li>TypeScript 可处理已有的 JavaScript 代码，并只对其中的 TypeScript 代码进行编译。</li>
<li>TypeScript 文件的后缀名 .ts （.ts，.tsx，.dts），JavaScript 文件是 .js。</li>
<li>在编写 TypeScript 的文件的时候就会自动编译成 js 文件。</li>
<li>TypeScript 在开发时就能给出编译错误，而 JavaScript 错误则需要在运行时才能暴露。作为强类型语言，你可以明确知道数据的类型，代码可读性极强。</li>
</ol>
<h2 id="安装使用-TypeScript"><a href="#安装使用-TypeScript" class="headerlink" title="安装使用 TypeScript"></a><strong>安装使用 TypeScript</strong></h2><p>打开终端 terminal 输入全局安装命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g typescript </span><br></pre></td></tr></table></figure>

<p>新建一个文件 index.ts，在终端输入 tsc index.ts 编译文件，编译成功则会生成一个同名的 js 文件。</p>
<h2 id="TypeScript数据类型"><a href="#TypeScript数据类型" class="headerlink" title="TypeScript数据类型"></a>TypeScript数据类型</h2><p>原始数据类型：</p>
<ul>
<li>boolean 布尔值</li>
<li>number 数值</li>
<li>string 字符串</li>
<li>null 空值</li>
<li>undefined 未定义</li>
<li>Symbol （ES6 中的新类型）</li>
</ul>
<p>非原始数据类型：</p>
<ul>
<li>数组</li>
<li>Tuple 元祖</li>
<li>enum 枚举</li>
<li>never 永不存在的值的类型</li>
<li>void</li>
<li>any 任意类型</li>
<li>联合类型</li>
<li>函数类型</li>
<li>对象类型</li>
</ul>
<p>其中元组、枚举、任意值、void 类型和 never 类型是 TypeScript 有别于 JavaScript 的特有类型。在 TypeScript 中声明变量，需要加上类型声明，例如 boolean 和 string 等。通过静态类型约束，在编译时执行类型检查，可以避免一些类型混用的低级错误。</p>
<h3 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">bo</span>: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>和 JavaScript 一样，TypeScript 里的所有数字都是浮点数。 这些浮点数的类型是 <code>number</code>。 除了支持十进制和十六进制字面量，TypeScript 还支持 ECMAScript 2015 中引入的二进制和八进制字面量。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="attr">a</span>: <span class="built_in">number</span> = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// ES6 中的二进制表示法</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">b</span>: <span class="built_in">number</span> = <span class="number">0b1000</span>;</span><br><span class="line"><span class="comment">// ES6 中的八进制表示法</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">c</span>: <span class="built_in">number</span> = <span class="number">0o102</span>;</span><br></pre></td></tr></table></figure>

<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>和 JavaScript 一样，可以使用双引号（ <code>&quot;</code>）或单引号（<code>&#39;</code>）表示字符串，还可以使用模板字符串。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="attr">myName</span>: <span class="built_in">string</span> = <span class="string">&quot;xiaoming&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">myAge</span>: <span class="built_in">number</span> = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">sentence</span>: <span class="built_in">string</span> = <span class="string">`Hello, my name is <span class="subst">$&#123;myName&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h3><p>JavaScript 没有空值（Void）的概念，在 TypeScript 中，声明一个 <code>void</code> 类型的变量没有什么用，因为你只能将它赋值为 <code>undefined</code> 和 <code>null</code>，可以用 <code>void</code> 表示没有任何返回值的函数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">unde</span>: <span class="built_in">void</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">nu</span>: <span class="built_in">void</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">alertName</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;My name is Tom&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们尝试把一个数字赋值给声明了 <code>void</code>类型的变量，这个时候就会给出错误提示。</p>
<h3 id="Null-和-Undefined"><a href="#Null-和-Undefined" class="headerlink" title="Null 和 Undefined"></a>Null 和 Undefined</h3><p>在 TypeScript 中，可以使用 <code>null</code> 和 <code>undefined</code> 来定义这两个原始数据类型，与 <code>void</code> 的区别是，<code>undefined</code> 和 <code>null</code> 是所有类型的子类型。也就是说 <code>undefined</code> 类型的变量，可以赋值给 <code>number</code> 类型的变量。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">un</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">nu</span>: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 这样不会报错</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">// 这样也不会报错</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">un</span>: <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>: <span class="built_in">number</span> = un;</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>定义数组有两种方式。</p>
<p><strong>第一种：普通方式。</strong></p>
<p>可以在元素类型后面接上 <code>[]</code>，表示由此类型元素组成的一个数组，数组的项中不允许出现其他的类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br></pre></td></tr></table></figure>

<p><strong>第二种:泛型方式 <code>Array&lt;元素类型&gt;</code>。</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">list</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="元祖"><a href="#元祖" class="headerlink" title="元祖"></a>元祖</h3><p>元组类型允许表示一个已知元素数量和类型的数组，各元素的类型不必相同。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">x = [<span class="string">&quot;Hello&quot;</span>, <span class="number">10</span>];</span><br></pre></td></tr></table></figure>

<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>使用枚举我们可以定义一些带名字的常量。 使用枚举可以清晰地表达意图或创建一组有区别的用例。 TypeScript 支持数字的和基于字符串的枚举。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">rat</span>: <span class="built_in">number</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">cattle</span>: <span class="built_in">number</span> = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">tiger</span>: <span class="built_in">number</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">rabbit</span>: <span class="built_in">number</span> = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">dragon</span>: <span class="built_in">number</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>上述只声明了 5 个，如果声明全排位，需要声明 12 个变量，并且注明类型，但是却多了很多重复性工作，利用数字枚举，我们可以轻松声明同样的一组常量。</p>
<p><strong>数字枚举</strong></p>
<p>默认情况下，从 0 开始为元素编号。 你也可以手动的指定成员的数值。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ChineseZodiac</span> &#123;</span><br><span class="line">  rat,</span><br><span class="line">  cattle,</span><br><span class="line">  tiger,</span><br><span class="line">  rabbit,</span><br><span class="line">  dragon,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译为js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">ChineseZodiac</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">ChineseZodiac</span>) &#123;</span><br><span class="line">    <span class="title class_">ChineseZodiac</span>[<span class="title class_">ChineseZodiac</span>[<span class="string">&quot;rat&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;rat&quot;</span>;</span><br><span class="line">    <span class="title class_">ChineseZodiac</span>[<span class="title class_">ChineseZodiac</span>[<span class="string">&quot;cattle&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;cattle&quot;</span>;</span><br><span class="line">    <span class="title class_">ChineseZodiac</span>[<span class="title class_">ChineseZodiac</span>[<span class="string">&quot;tiger&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;tiger&quot;</span>;</span><br><span class="line">    <span class="title class_">ChineseZodiac</span>[<span class="title class_">ChineseZodiac</span>[<span class="string">&quot;rabbit&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;rabbit&quot;</span>;</span><br><span class="line">    <span class="title class_">ChineseZodiac</span>[<span class="title class_">ChineseZodiac</span>[<span class="string">&quot;dragon&quot;</span>] = <span class="number">4</span>] = <span class="string">&quot;dragon&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">ChineseZodiac</span> || (<span class="title class_">ChineseZodiac</span> = &#123;&#125;));</span><br></pre></td></tr></table></figure>

<p><strong>字符串枚举</strong></p>
<p>在一个字符串枚举里，每个成员都必须用字符串字面量，或另外一个字符串枚举成员进行初始化。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  name = <span class="string">&quot;NAME&quot;</span>,</span><br><span class="line">  age = <span class="string">&quot;AGE&quot;</span>,</span><br><span class="line">  love = <span class="string">&quot;LOVE&quot;</span>,</span><br><span class="line">  hobby = <span class="string">&quot;HOBBY&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property">name</span>); <span class="comment">// NAME</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property">hobby</span>); <span class="comment">// HOBBY</span></span><br></pre></td></tr></table></figure>

<h3 id="never"><a href="#never" class="headerlink" title="never"></a>never</h3><p>never 类型是任何类型的子类型，也可以赋值给任何类型，一般作为函数返回值。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回never的函数必须存在无法达到的终点</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="void"><a href="#void" class="headerlink" title="void"></a>void</h4><p>void 类型像是与 any 类型相反，它表示没有任何类型。 当一个函数没有返回值时，你通常会见到其返回值类型是 void。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">warn</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This is my warning message&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="any-任意类型"><a href="#any-任意类型" class="headerlink" title="any 任意类型"></a>any 任意类型</h3><p>任意值（Any）用来表示允许赋值为任意类型。声明一个变量为任意值之后，对它的任何操作，返回的内容的类型都是任意值。变量如果在声明的时候，未指定其类型，那么它会被识别为任意值类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">notSure</span>: <span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">&quot;这是字符串&quot;</span>;</span><br><span class="line">notSure = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>当你不希望类型检查器对某些值进行检查而是直接让它们通过编译阶段的检查可以使用 any 类型来标记这些变量。</p>
<h3 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h3><p>联合类型（Union Types）表示取值可以为多种类型中的一种。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line">num = <span class="string">&quot;seven&quot;</span>;</span><br><span class="line">num = <span class="number">7</span>;</span><br></pre></td></tr></table></figure>

<p>联合类型使用 <code>|</code> 分隔每个类型。这里的 <code>let num: string | number</code> 的含义是，允许 <code>num</code> 的类型是 <code>string</code> 或者 <code>number</code>，但是不能是其他类型。</p>
<h3 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h3><p>object 表示非原始类型，也就是除 number，string，boolean，symbol，null 或 undefined 之外的类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">o: <span class="built_in">object</span> | <span class="literal">null</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="title function_">create</span>(&#123; <span class="attr">name</span>: <span class="number">0</span> &#125;); <span class="comment">// OK</span></span><br><span class="line"><span class="title function_">create</span>(<span class="literal">null</span>); <span class="comment">// OK</span></span><br><span class="line"><span class="title function_">create</span>(<span class="number">2</span>); <span class="comment">// Error</span></span><br><span class="line"><span class="title function_">create</span>(<span class="string">&quot;字符串&quot;</span>); <span class="comment">// Error</span></span><br><span class="line"><span class="title function_">create</span>(<span class="literal">false</span>); <span class="comment">// Error</span></span><br><span class="line"><span class="title function_">create</span>(<span class="literal">undefined</span>); <span class="comment">// Error</span></span><br></pre></td></tr></table></figure>

<h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><p>类型断言可以用来手动指定一个值的类型，即允许变量从一种类型更改为另一种类型。</p>
<p>语法格式：<code>&lt;类型&gt;值 或 值as类型</code></p>
<p><strong>方式一</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">someAny</span>: <span class="built_in">any</span> = <span class="string">&quot;my name is tony&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLength</span>: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someAny).<span class="property">length</span>;</span><br></pre></td></tr></table></figure>

<p><code>someAny</code> 作为 <code>any</code> 类型是不可以使用字符串方法的，所以这个时候我们可以使用类型断言对此进行转换。</p>
<p><strong>方式二</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">someAny</span>: <span class="built_in">any</span> = <span class="string">&quot;my name is tony&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLength</span>: <span class="built_in">number</span> = (someAny <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br></pre></td></tr></table></figure>

<p>效果是一样的。</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>在 TypeScript 中，我们使用接口（Interfaces）来定义对象的类型。接口是一系列抽象方法的声明，是一些方法特征的集合，这些方法都应该是抽象的，需要由具体的类去实现，然后第三方就可以通过这组抽象方法调用，让具体的类执行具体的方法。</p>
<p><strong>接口的作用：</strong></p>
<ol>
<li>对类的一部分行为进行抽象（类的部分后续会讲到）</li>
<li>描述对象的形状</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">age</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们定义了一个接口 <code>Person</code>，接着定义了一个变量 <code>tom</code>，它的类型是 <code>Person</code>。这样，我们就约束了 <code>tom</code> 的形状必须和接口 <code>Person</code> 一致。</p>
<p><strong>注意：</strong></p>
<p>接口一般首字母大写，也可以在接口之前加大写 <code>I</code> ，赋值的时候，变量的形状必须和接口的形状保持一致。不允许添加未定义的属性。</p>
<p>有时我们希望不要完全匹配一个形状，那么可以用可选属性。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在属性后使用 <code>?</code> 表示这个属性是可选属性，可选属性的含义是该属性可以不存在，但是仍然不允许添加未定义的属性。</p>
<p>有时候我们希望一个接口允许有任意的属性，可以使用如下方式。使用 <code>[propName: string]</code> 定义任意属性取 <code>string</code> 类型的值。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">  [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&quot;male&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>有时候我们希望对象中的一些字段只能在创建的时候被赋值，那么可以用 <code>readonly</code> 定义只读属性，如果使用 <code>readonly</code> 定义的属性 <code>id</code> 初始化后，又被赋值了，那么就会报错了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">  [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&quot;male&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>传统方法中，JavaScript 通过构造函数实现类的概念，通过原型链实现继承，而在 ES6 中，我们能够使用 <code>class</code>。TypeScript 除了实现了所有 ES6 中的类的功能以外，还添加了一些新的用法。这一节主要介绍类的用法，下一节再介绍如何定义类的类型。</p>
<p>如果你有其他面向对象语言的经验，那么（Class） 类就是比较简单的常用的类型，如果你之前没有使用过，那么先介绍一下概念方便理解。</p>
<p><strong>类（Class）</strong></p>
<p>定义了一件事物的抽象特点，包含它的属性和方法。</p>
<p><strong>对象（Object）</strong></p>
<p>类的实例，通过 new 生成。</p>
<p><strong>面向对象（OOP）的三大特性</strong></p>
<p>封装、继承、多态。</p>
<p><strong>封装（Encapsulation）</strong></p>
<p>将对数据的操作细节隐藏起来，只暴露对外的接口。外界调用端不需要（也不可能）知道细节，就能通过对外提供的接口来访问该对象，同时也保证了外界无法任意更改对象内部的数据。</p>
<p><strong>继承（Inheritance）</strong></p>
<p>子类继承父类，子类除了拥有父类的所有特性外，还有一些更具体的特性。</p>
<p><strong>多态（Polymorphism）</strong></p>
<p>由继承而产生了相关的不同的类，对同一个方法可以有不同的响应。比如 Cat 和 Dog 都继承自 Animal，但是分别实现了自己的 run 方法。此时针对某一个实例，我们无需了解它是 Cat 还是 Dog，就可以直接调用 run 方法，程序会自动判断出来应该如何执行 run。</p>
<p><strong>存取器（getter &amp; setter）</strong></p>
<p>用以改变属性的读取和赋值行为。</p>
<p><strong>抽象类（Abstract Class）</strong></p>
<p>抽象类是供其他类继承的基类，抽象类不允许被实例化。抽象类中的抽象方法必须在子类中被实现。</p>
<p><strong>修饰符（Modifiers）</strong></p>
<p>修饰符是一些关键字，用于限定成员或类型的性质。比如 public 表示公有属性或方法。</p>
<p><strong>接口（Interfaces）</strong></p>
<p>不同类之间公有的属性或方法，可以抽象成一个接口。接口可以被类实现（implements）。一个类只能继承自另一个类，但是可以实现多个接口。</p>
<h3 id="类的定义"><a href="#类的定义" class="headerlink" title="类的定义"></a>类的定义</h3><p>使用 <code>class</code> 定义类，使用 <code>constructor</code> 定义构造函数。类一般包括属性 + 方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  <span class="attr">greeting</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">message: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">greeting</span> = message;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;Hello, &quot;</span> + <span class="variable language_">this</span>.<span class="property">greeting</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> <span class="title class_">Greeter</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">greeter.<span class="title function_">greet</span>();</span><br></pre></td></tr></table></figure>

<h3 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h3><p>使用 <code>extends</code> 关键字实现继承，子类中使用 <code>super</code> 关键字来调用父类的构造函数和方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 构造函数，实例化类的时候触发的方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;父亲&quot;</span>);</span><br><span class="line">p.<span class="title function_">run</span>(); <span class="comment">// 父亲在运动</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类继承父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name); <span class="comment">// 初始化父类的构造函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;儿子&quot;</span>);</span><br><span class="line">c.<span class="title function_">run</span>(); <span class="comment">// 儿子在运动</span></span><br></pre></td></tr></table></figure>

<h3 id="类里面的修饰符"><a href="#类里面的修饰符" class="headerlink" title="类里面的修饰符"></a>类里面的修饰符</h3><p>Typescript 里面定义属性的时候给我们提供了三种修饰符：</p>
<ul>
<li>public：公有，在当前类里面、子类、类外面都可以访问。</li>
<li>protected：保护类型，在当前类里面、子类里面可以访问，在类外部没法访问。</li>
<li>private：私有，在当前类里面可以访问，子类、类外部都没法访问。</li>
</ul>
<p>注意：属性如果不加修饰符，默认就是公有（public）。</p>
<p><strong>public</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>; <span class="comment">// 公有</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动`</span>); <span class="comment">// 在类里能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">p.<span class="title function_">run</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>); <span class="comment">// 在类外面能访问</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动--子类`</span>); <span class="comment">// 子类能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">c.<span class="title function_">run</span>(); <span class="comment">// 李四在运动--子类</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="property">name</span>); <span class="comment">// 在类外面能访问</span></span><br></pre></td></tr></table></figure>

<p><strong>protected</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">name</span>: <span class="built_in">string</span>; <span class="comment">// 保护</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动`</span>); <span class="comment">// 在类里能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">p.<span class="title function_">run</span>();</span><br><span class="line"><span class="comment">// console.log(p.name); // 报错，在类外面不能访问</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动--子类`</span>); <span class="comment">// 子类能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">c.<span class="title function_">run</span>(); <span class="comment">// 李四在运动--子类</span></span><br><span class="line"><span class="comment">// console.log(c.name); // 报错，在类外面不能访问</span></span><br></pre></td></tr></table></figure>

<p><strong>private</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">name</span>: <span class="built_in">string</span>; <span class="comment">// 私有</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动`</span>); <span class="comment">// 在类里能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">p.<span class="title function_">run</span>();</span><br><span class="line"><span class="comment">// console.log(p.name); // 报错，在类外面不能访问</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(`$&#123;this.name&#125;在运动--子类`); // 报错，子类不能访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">c.<span class="title function_">run</span>(); <span class="comment">// 李四在运动--子类</span></span><br><span class="line"><span class="comment">// console.log(c.name); // 报错，在类外面不能访问</span></span><br></pre></td></tr></table></figure>

<h3 id="静态属性和方法"><a href="#静态属性和方法" class="headerlink" title="静态属性和方法"></a>静态属性和方法</h3><p>使用 static 修饰符修饰的方法称为静态方法，它们不需要实例化，而是直接通过类来调用，若加上修饰符，和其他属性和方法效果一样。</p>
<p>ES5 中的静态方法、静态属性：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">run1</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;; <span class="comment">// 实例方法，实例化后调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property">run2</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;; <span class="comment">// 静态方法，类名直接调用</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property">name</span> = <span class="string">&quot;lucy&quot;</span>; <span class="comment">// 静态属性</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">run2</span>(); <span class="comment">// 静态方法的调用</span></span><br></pre></td></tr></table></figure>

<p>TypeScript 中的静态方法、静态属性：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">static</span> sex = <span class="string">&quot;男&quot;</span>; <span class="comment">// 静态属性</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在运动`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">work</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>在工作`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">print</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;print静态方法&quot;</span> + <span class="title class_">Person</span>.<span class="property">sex</span>); <span class="comment">// 静态方法，没法直接调用类的属性</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;tony&quot;</span>);</span><br><span class="line">p.<span class="title function_">work</span>();</span><br><span class="line">p.<span class="title function_">run</span>();</span><br><span class="line"><span class="title class_">Person</span>.<span class="property">sex</span>; <span class="comment">// 男</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">print</span>();</span><br></pre></td></tr></table></figure>

<h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><p><code>abstract</code> 用于定义抽象类和其中的抽象方法。</p>
<p>什么是抽象类？</p>
<p>首先，抽象类是不允许被实例化的：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> name;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">sayHi</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;tony&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们定义了一个抽象类 <code>Animal</code>，并且定义了一个抽象方法 <code>sayHi</code>。在实例化抽象类的时候会报错。</p>
<p>其次，抽象类中的抽象方法必须被子类实现：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> name;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">sayHi</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is eating.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&quot;Tom&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们定义了一个类 <code>Cat</code> 继承了抽象类 <code>Animal</code>，但是没有实现抽象方法 <code>sayHi</code>，所以编译会报错。</p>
<p>正确使用：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> name;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">sayHi</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Meow, My name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">cat.<span class="title function_">sayHi</span>();</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数是 JavaScript 应用程序的基础。 它帮助你实现抽象层，模拟类，信息隐藏和模块。 在 TypeScript 里，函数仍然是主要的定义行为的地方。 TypeScript 为 JavaScript 函数添加了额外的功能，让我们可以更容易地使用。</p>
<p>和 JavaScript 一样，TypeScript 函数可以创建有名字的函数和匿名函数。 你可以随意选择适合应用程序的方式，不论是定义一系列 API 函数还是只使用一次的函数。</p>
<p>ES5 函数定义：函数声明、匿名函数、传参。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn1</span>(); <span class="comment">// 调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名函数</span></span><br><span class="line"><span class="keyword">let</span> fn2 = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">456</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">fn2</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传参</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn3</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：<span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn3</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<p>TypeScript 函数定义：函数声明、匿名函数、传参。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="comment">// number 是函数返回值类型，没有返回值为 void</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;有返回值&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn1</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名函数</span></span><br><span class="line"><span class="keyword">let</span> fn2 = <span class="keyword">function</span> (<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">456</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">fn2</span>();</span><br><span class="line"><span class="comment">// 传参</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn3</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：<span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn3</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<p><strong>可选参数</strong></p>
<p>ES5 里面方法的实参和行参可以不一样，但是 TypeScript 中必须一样，如果不一样就需要配置可选参数。</p>
<p><strong>注意</strong> ：可选参数必须配置到参数的最后面。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span>, age?: <span class="built_in">number</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="comment">// age 为可选参数</span></span><br><span class="line">  <span class="keyword">if</span> (age) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：<span class="subst">$&#123;age&#125;</span>`</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：保密`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getInfo</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getInfo</span>(<span class="string">&quot;李四&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>默认参数</strong></p>
<p>ES5 里面不能设置默认参数，ES6 和 TypeScript 中都可以设置默认参数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span> = <span class="number">20</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="comment">// age 默认为20</span></span><br><span class="line">  <span class="keyword">if</span> (age) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：<span class="subst">$&#123;age&#125;</span>`</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：保密`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getInfo</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>)); <span class="comment">// 姓名：张三，年龄：18</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getInfo</span>(<span class="string">&quot;李四&quot;</span>)); <span class="comment">// 姓名：李四，年龄：20</span></span><br></pre></td></tr></table></figure>

<p><strong>剩余参数</strong></p>
<p>ES6 中，可以使用 <code>...rest</code> 的方式获取函数中的剩余参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">push</span>(<span class="params">array, ...items</span>) &#123;</span><br><span class="line">  items.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">    array.<span class="title function_">push</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [];</span><br><span class="line"><span class="title function_">push</span>(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="title function_">alert</span>(a);</span><br></pre></td></tr></table></figure>

<p>事实上，<code>items</code> 是一个数组。所以我们可以用数组的类型来定义它，在 TypeScript 里，你可以把所有参数收集到一个变量里：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">push</span>(<span class="params">array: <span class="built_in">any</span>[], ...items: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  items.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">    array.<span class="title function_">push</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [];</span><br><span class="line"><span class="title function_">push</span>(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="title function_">alert</span>(a);</span><br></pre></td></tr></table></figure>

<p><strong>用接口定义函数的形状</strong></p>
<p>我们也可以使用接口的方式来定义一个函数需要符合的形状。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Fn</span> &#123;</span><br><span class="line">  (<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">//左边表示函数的输入类型，右边表示输出类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">fn</span>: <span class="title class_">Fn</span>;</span><br><span class="line">fn = <span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x &gt; y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>函数重载</strong></p>
<p>JavaScript 中方法的重载：重载指的是两个或者两个以上同名函数，但它们的参数不一样，这时会出现函数重载的情况。</p>
<p>Typescript 中的重载：通过为同一个函数提供多个函数类型定义来实现多种功能的目的。</p>
<p>ES5 中出现同名方法，下面的会替换上面的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name</span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name, age</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Typescript 中的重载：</p>
<ul>
<li>单个参数，不同类型。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">age: <span class="built_in">number</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">str: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`姓名：<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`年龄：<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getInfo</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"><span class="title function_">getInfo</span>(<span class="number">18</span>);</span><br><span class="line"><span class="title function_">getInfo</span>(<span class="literal">true</span>); <span class="comment">// 错误的写法</span></span><br></pre></td></tr></table></figure>

<ul>
<li>多个参数，可选参数。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">name: <span class="built_in">string</span>, age?: <span class="built_in">number</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (age) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>，年龄：<span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getInfo</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"><span class="title function_">getInfo</span>(<span class="number">18</span>); <span class="comment">// 错误</span></span><br><span class="line"><span class="title function_">getInfo</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>从 ECMAScript 2015 开始，JavaScript 引入了模块的概念。 TypeScript 也沿用这个概念。模块在其自身的作用域里执行，而不是在全局作用域里。这意味着定义在一个模块里的变量，函数，类等等在模块外部是不可见的，除非你使用 export 导出它们。 相反，如果想使用其它模块导出的变量，函数，类，接口等的时候，你可以通过 import 导入它们。</p>
<p><strong>模块的导入与导出</strong></p>
<p>模块是自声明的。在 TypeScript 里，两个模块之间的关系是通过在文件级别上使用 import 和 export 建立的。下面是一个基本例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Animal</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./a&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">dog.<span class="property">name</span> = <span class="string">&quot;狗狗&quot;</span>;</span><br><span class="line">dog.<span class="title function_">show</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>

<p>上面的例子里，在 <code>a.ts</code> 里声明了一个类 Animal，通过 export 导出。在 <code>b.ts</code> 里，指定相对文件路径，通过 import 导入，就可以使用 Animal 类。</p>
<p><strong>导入和导出的重命名</strong></p>
<p>模块导入和导出时默认使用的内部对象的名称。TypeScript 也支持在导出前和导入后进行重命名。将上面的例子修改一下:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.ts</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Animal</span> <span class="keyword">as</span> <span class="variable constant_">ANI</span> &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ANI</span> <span class="keyword">as</span> <span class="title class_">Animal</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./a&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">dog.<span class="property">name</span> = <span class="string">&quot;狗狗&quot;</span>;</span><br><span class="line">dog.<span class="title function_">show</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;重命名-狗狗&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>导入和导出时，通过 <code>as</code> 关键字对模块进行重命名。这个地方有一点要注意，当导出的模块重命名后，导入时重命名前的模块名要与导出重命名后的模块名保持一致，否则编译器将提示错误信息。以上面的这个例子为例，导出的模块被重命名为 <code>ANI</code>，将此模块在另外一个文件 <code>b.ts</code>里导入时，<code>as</code> 关键字前面的模块名必须是 <code>ANI</code>。</p>
<p>如果不知道导入模块的名称，则可以用 <code>*</code> 号代替。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> animal_module <span class="keyword">from</span> <span class="string">&quot;./a&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> animal_module.<span class="title function_">ANI</span>();</span><br><span class="line">dog.<span class="property">name</span> = <span class="string">&quot;狗狗&quot;</span>;</span><br><span class="line">dog.<span class="title function_">show</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;重命名-狗狗-*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>导入和导出多个对象</strong></p>
<p>通常情况，模块里会定义多个类型对象，然后一并导出。而导入的模块里也可能会有多个。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.ts</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span> = <span class="string">&quot;Red&quot;</span>,</span><br><span class="line">  <span class="title class_">Blue</span> = <span class="string">&quot;Blue&quot;</span>,</span><br><span class="line">  <span class="title class_">White</span> = <span class="string">&quot;White&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">color</span>: <span class="title class_">Color</span>;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Animal</span>, <span class="title class_">Color</span> &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> animal_module <span class="keyword">from</span> <span class="string">&quot;./a&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> animal_module.<span class="title class_">Animal</span>();</span><br><span class="line">dog.<span class="property">name</span> = <span class="string">&quot;狗狗&quot;</span>;</span><br><span class="line">dog.<span class="property">color</span> = animal_module.<span class="property">Color</span>.<span class="property">Red</span>;</span><br><span class="line">dog.<span class="title function_">show</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="property">name</span> + dog.<span class="property">color</span>);</span><br></pre></td></tr></table></figure>

<p><strong>默认导出</strong></p>
<p>对于导出内容的命名无关紧要，只要给定名称即可，但默认导出只有一个。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.ts</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Animal</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Animal</span> <span class="keyword">from</span> <span class="string">&quot;./a&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">dog.<span class="property">name</span> = <span class="string">&quot;狗狗&quot;</span>;</span><br><span class="line">dog.<span class="title function_">show</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/08/13/typescript/" data-id="clm52imvz000mc4wp0qqxdap2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ts/" rel="tag">ts</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/MongoDB/" class="article-date">
  <time datetime="2023-06-02T15:32:34.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/MongoDB/">MongoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="Mongodb-是什么"><a href="#Mongodb-是什么" class="headerlink" title="Mongodb 是什么"></a>Mongodb 是什么</h3><blockquote>
<p>MongoDB 是一个基于分布式文件存储的数据库，官方地址 <a target="_blank" rel="noopener" href="https://www.mongodb.com/">https://www.mongodb.com/</a></p>
</blockquote>
<h3 id="数据库是什么"><a href="#数据库是什么" class="headerlink" title="数据库是什么"></a>数据库是什么</h3><p>数据库（DataBase）是按照数据结构来组织、存储和管理数据的 <code>应用程序</code></p>
<h3 id="数据库的作用"><a href="#数据库的作用" class="headerlink" title="数据库的作用"></a>数据库的作用</h3><p>数据库的主要作用就是 <code>管理数据</code>，对数据进行 <code>增（c）、删（d）、改（u）、查（r）</code></p>
<h3 id="数据库管理数据的特点"><a href="#数据库管理数据的特点" class="headerlink" title="数据库管理数据的特点"></a>数据库管理数据的特点</h3><p>相比于纯文件管理数据，数据库管理数据有如下特点：</p>
<ol>
<li>速度更快</li>
<li>扩展性更强</li>
<li>安全性更强</li>
</ol>
<h3 id="为什么选择-Mongodb"><a href="#为什么选择-Mongodb" class="headerlink" title="为什么选择 Mongodb"></a>为什么选择 Mongodb</h3><p>操作语法与 JavaScript 类似，容易上手，学习成本低</p>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>Mongodb 中有三个重要概念需要掌握</p>
<ul>
<li>数据库（database） 数据库是一个数据仓库，数据库服务下可以创建很多数据库，数据库中可以存放很多集合</li>
<li>集合（collection） 集合类似于 JS 中的数组，在集合中可以存放很多文档</li>
<li>文档（document）   文档是数据库中的最小单位，类似于 JS 中的对象</li>
</ul>
<img src="./assets/f9e871ef89956cc15ef0e89aa7ac8e7839da10d6.jpg" alt="09_mongodb" style="zoom: 67%;" />

<p>JSON 文件示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;accounts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  	<span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3-YLju5f3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;买电脑&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-02-08&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5500&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;remarks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;为了上网课&quot;</span></span><br><span class="line">  	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="punctuation">&#123;</span></span><br><span class="line">  		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3-YLju5f4&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;请女朋友吃饭&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-02-08&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;214&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remarks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;情人节聚餐&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mRQiD4s3K&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;发工资&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-02-19&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4396&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remarks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;终于发工资啦!~~&quot;</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">  	<span class="punctuation">&#123;</span></span><br><span class="line">  		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line">  	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="punctuation">&#123;</span></span><br><span class="line">  		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lisi&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">  	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="punctuation">&#123;</span></span><br><span class="line">  		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wangwu&quot;</span><span class="punctuation">,</span></span><br><span class="line">  		<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">22</span></span><br><span class="line">  	<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>大家可以通过 JSON 文件来理解 Mongodb 中的概念</p>
<ul>
<li>一个 <code>JSON 文件</code> 好比是一个 <code>数据库</code>，一个 Mongodb 服务下可以有 N 个数据库</li>
<li>JSON 文件中的 <code>一级属性的数组值</code> 好比是 <code>集合</code></li>
<li>数组中的对象好比是 <code>文档</code></li>
<li>对象中的属性有时也称之为 <code>字段</code></li>
</ul>
<blockquote>
<p>一般情况下</p>
<ul>
<li>一个项目使用一个数据库</li>
<li>一个集合会存储同一种类型的数据</li>
</ul>
</blockquote>
<h2 id="下载安装与启动"><a href="#下载安装与启动" class="headerlink" title="下载安装与启动"></a>下载安装与启动</h2><p>下载地址： <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p>
<p>建议选择 <code>zip</code> 类型， 通用性更强</p>
<p>配置步骤如下:</p>
<pre><code>1&gt; 将压缩包移动到`C:\Program Files` 下，然后解压

2&gt; 创建`C:\data\db` 目录，mongodb 会将数据默认保存在这个文件夹

3&gt; 以 mongodb 中 bin 目录作为工作目录，启动命令行

4&gt; 运行命令`mongod`
</code></pre>
<p><img src="./assets/e036cbab1d55c5ade9389e3f7a4664847803cecf.jpg" alt="09_mongodb"></p>
<p>看到最后的 <code>waiting for connections</code> 则表明服务 <code>已经启动成功</code></p>
<p>然后可以使用 <code>mongo</code> 命令连接本机的 mongodb 服务</p>
<p><img src="./assets/06fcfe57e7ec2be01971894e0fb15bb14e3dfec0.jpg" alt="09_mongodb"></p>
<blockquote>
<p>注意：</p>
<ul>
<li>为了方便后续方便使用 mongod 命令，可以将 bin 目录配置到环境变量 Path 中</li>
<li><code>千万不要选中服务端窗口的内容</code>，选中会停止服务，可以 <code>敲回车</code> 取消选中</li>
</ul>
</blockquote>
<p>配置windows服务: <a target="_blank" rel="noopener" href="https://www.shuzhiduo.com/A/E35pAE6Ydv/">https://www.shuzhiduo.com/A/E35pAE6Ydv/</a></p>
<p>修改 <code>mongodb</code>数据库位置</p>
<p><img src="./assets/image-20230327010148369.png" alt="image-20230327010148369"></p>
<h2 id="命令行交互"><a href="#命令行交互" class="headerlink" title="命令行交互"></a>命令行交互</h2><p>命令行交互一般是学习数据库的第一步，不过这些命令在后续用的比较少，所以大家了解即可</p>
<h3 id="数据库命令"><a href="#数据库命令" class="headerlink" title="数据库命令"></a>数据库命令</h3><ol>
<li><p>显示所有的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs</span><br></pre></td></tr></table></figure></li>
<li><p>切换到指定的数据库，如果数据库不存在会自动创建数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前所在的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db</span><br></pre></td></tr></table></figure></li>
<li><p>删除当前数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use 库名</span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="集合命令"><a href="#集合命令" class="headerlink" title="集合命令"></a>集合命令</h3><ol>
<li><p>创建集合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(<span class="string">&#x27;集合名称&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前数据库中的所有集合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> collections</span><br></pre></td></tr></table></figure></li>
<li><p>删除某个集合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="keyword">drop</span>()</span><br></pre></td></tr></table></figure></li>
<li><p>重命名集合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.renameCollection(<span class="string">&#x27;newName&#x27;</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="文档命令"><a href="#文档命令" class="headerlink" title="文档命令"></a>文档命令</h3><ol>
<li><p>插入文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="keyword">insert</span>(文档对象);</span><br></pre></td></tr></table></figure></li>
<li><p>查询文档</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="title function_">find</span>(查询条件)</span><br></pre></td></tr></table></figure>

<p><code>&lt;span style=&quot;color:red&quot;&gt;</code>_id 是 mongodb 自动生成的唯一编号，用来唯一标识文档</p>
</li>
<li><p>更新文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="keyword">update</span>(查询条件,新的文档)</span><br><span class="line">db.集合名.<span class="keyword">update</span>(&#123;name:<span class="string">&#x27;张三&#x27;</span>&#125;,&#123;$<span class="keyword">set</span>:&#123;age:<span class="number">19</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>删除文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.remove(查询条件)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><h4 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h4><ul>
<li>用户注册</li>
<li>发布视频</li>
<li>发布商品</li>
<li>发朋友圈</li>
<li>发评论</li>
<li>发微博</li>
<li>发弹幕</li>
<li>…….</li>
</ul>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ul>
<li>删除评论</li>
<li>删除商品</li>
<li>删除文章</li>
<li>删除视频</li>
<li>删除微博</li>
<li>……</li>
</ul>
<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><ul>
<li>更新个人信息</li>
<li>修改商品价格</li>
<li>修改文章内容</li>
<li>……</li>
</ul>
<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><ul>
<li>商品列表</li>
<li>视频列表</li>
<li>朋友圈列表</li>
<li>微博列表</li>
<li>搜索功能</li>
<li>……</li>
</ul>
<h2 id="Mongoose"><a href="#Mongoose" class="headerlink" title="Mongoose"></a>Mongoose</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p> Mongoose 是一个对象文档模型库，官网 <a target="_blank" rel="noopener" href="http://www.mongoosejs.net/">http://www.mongoosejs.net/</a></p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>方便使用代码操作 mongodb 数据库</p>
<h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//1. 安装 mongoose</span></span><br><span class="line"> <span class="comment">//2. 导入 mongoose</span></span><br><span class="line"> <span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//3. 连接数据库                              数据库名称</span></span><br><span class="line"> mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//4. 设置连接回调</span></span><br><span class="line"> <span class="comment">//连接成功   once 一次   事件回调函数只执行一次</span></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接成功&#x27;</span>);</span><br><span class="line"> 	<span class="comment">//5. 创建文档结构对象</span></span><br><span class="line">    <span class="comment">// 设置集合中 文档的属性以及属性值得类型</span></span><br><span class="line"> 	<span class="keyword">let</span> <span class="title class_">BookSchema</span> = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line"> 		<span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line"> 		<span class="attr">author</span>: <span class="title class_">String</span>,</span><br><span class="line"> 		<span class="attr">price</span>: <span class="title class_">Number</span></span><br><span class="line"> 	&#125;);</span><br><span class="line">   </span><br><span class="line"> 	<span class="comment">//6. 创建文档模型对象  对文档操作的封装对象  mongoose会使用集合名称的复数，创建集合</span></span><br><span class="line"> 	<span class="keyword">let</span> <span class="title class_">BookModel</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;book&#x27;</span>, <span class="title class_">BookSchema</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//7. 插入文档</span></span><br><span class="line"> 	<span class="title class_">BookModel</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line"> 		<span class="attr">title</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line"> 		<span class="attr">author</span>: <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">		<span class="attr">price</span>: <span class="number">19.9</span></span><br><span class="line"> 	&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是否有错误</span></span><br><span class="line"> 		<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="comment">//输出 data 对象  如果没有出错，则输出插入后的文档对象</span></span><br><span class="line"> 		<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line"> 		<span class="comment">//8. 断开连接  关闭数据链接 (项目运行过程中，不会添加该代码)</span></span><br><span class="line"> 		mongoose.<span class="title function_">disconnect</span>();</span><br><span class="line"> 	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接出错</span></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接出错~~&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接关闭</span></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><p>文档结构可选的常用字段类型列表</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String</td>
<td>字符串</td>
</tr>
<tr>
<td>Number</td>
<td>数字</td>
</tr>
<tr>
<td>Boolean</td>
<td>布尔值</td>
</tr>
<tr>
<td>Array</td>
<td>数组，也可以使用 <code>[]</code> 来标识</td>
</tr>
<tr>
<td>Date</td>
<td>日期</td>
</tr>
<tr>
<td>Buffer</td>
<td>Buffer 对象</td>
</tr>
<tr>
<td>Mixed</td>
<td>任意类型，需要使用 <code>mongoose.Schema.Types.Mixed</code> 指定</td>
</tr>
<tr>
<td>ObjectId</td>
<td>对象 ID，需要使用 <code>mongoose.Schema.Types.ObjectId</code> 指定</td>
</tr>
<tr>
<td>Decimal128</td>
<td>高精度数字，需要使用 <code>mongoose.Schema.Types.Decimal128</code> 指定</td>
</tr>
</tbody></table>
<h3 id="字段值验证"><a href="#字段值验证" class="headerlink" title="字段值验证"></a>字段值验证</h3><p>Mongoose 有一些内建验证器，可以对字段值进行验证</p>
<h4 id="必填项"><a href="#必填项" class="headerlink" title="必填项"></a>必填项</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title</span>: &#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line"> 	<span class="attr">required</span>: <span class="literal">true</span> <span class="comment">// 设置必填项</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">author</span>: &#123;</span><br><span class="line"> 	<span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line"> 	<span class="attr">default</span>: <span class="string">&#x27;匿名&#x27;</span> <span class="comment">//默认值</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="枚举值"><a href="#枚举值" class="headerlink" title="枚举值"></a>枚举值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gender</span>: &#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">	<span class="attr">enum</span>: [<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>] <span class="comment">//设置的值必须是数组中的</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="唯一值"><a href="#唯一值" class="headerlink" title="唯一值"></a>唯一值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>: &#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line"> 	<span class="attr">unique</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>unique 需要 <code>重建集合</code> 才能有效果</p>
<p>永远不要相信用户的输入</p>
</blockquote>
<h3 id="CURD"><a href="#CURD" class="headerlink" title="CURD"></a>CURD</h3><p>数据库的基本操作包括四个，增加（create），删除（delete），修改（update），查（read）</p>
<h4 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h4><p>插入一条</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">	<span class="attr">title</span>:<span class="string">&#x27;给我一首歌的时间&#x27;</span>,</span><br><span class="line"> 	<span class="attr">author</span>: <span class="string">&#x27;Jay&#x27;</span></span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">	<span class="comment">//错误</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">	<span class="comment">//插入后的数据对象</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量插入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.引入mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.链接mongodb数据库 connect 连接</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://127.0.0.1:27017/project&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置连接的回调</span></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;open&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//4.声明文档结构</span></span><br><span class="line">	<span class="keyword">const</span> <span class="title class_">PhoneSchema</span> = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">		<span class="attr">brand</span>:<span class="title class_">String</span>,</span><br><span class="line">		<span class="attr">color</span>:<span class="title class_">String</span>,</span><br><span class="line">		<span class="attr">price</span>:<span class="title class_">Number</span>,</span><br><span class="line"> 		<span class="attr">tags</span>:<span class="title class_">Array</span></span><br><span class="line">	&#125;)</span><br><span class="line"> 	<span class="comment">//6.创建模型对象</span></span><br><span class="line"> 	<span class="keyword">const</span> <span class="title class_">PhoneModel</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;phone&#x27;</span>,<span class="title class_">PhoneSchema</span>);</span><br><span class="line"> 	<span class="title class_">PhoneModel</span>.<span class="title function_">insertMany</span>([</span><br><span class="line"> 		&#123;</span><br><span class="line"> 			<span class="attr">brand</span>:<span class="string">&#x27;华为&#x27;</span>,</span><br><span class="line"> 			<span class="attr">color</span>:<span class="string">&#x27;灰色&#x27;</span>,</span><br><span class="line"> 			<span class="attr">price</span>:<span class="number">2399</span>,</span><br><span class="line"> 			<span class="attr">tags</span>:[<span class="string">&#x27;电量大&#x27;</span>,<span class="string">&#x27;屏幕大&#x27;</span>,<span class="string">&#x27;信号好&#x27;</span>]</span><br><span class="line"> 		&#125;,</span><br><span class="line"> 		&#123;</span><br><span class="line"> 			<span class="attr">brand</span>:<span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line"> 			<span class="attr">color</span>:<span class="string">&#x27;白色&#x27;</span>,</span><br><span class="line"> 			<span class="attr">price</span>:<span class="number">2099</span>,</span><br><span class="line"> 			<span class="attr">tags</span>:[<span class="string">&#x27;电量大&#x27;</span>,<span class="string">&#x27;屏幕大&#x27;</span>,<span class="string">&#x27;信号好&#x27;</span>]</span><br><span class="line">         &#125;</span><br><span class="line">	],<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入成功&#x27;</span>);</span><br><span class="line">         mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><p>删除一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">deleteOne</span>(&#123;<span class="attr">_id</span>:<span class="string">&#x27;5dd65f32be6401035cb5b1ed&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"> 	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"> 	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量删除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">deleteMany</span>(&#123;<span class="attr">author</span>:<span class="string">&#x27;Jay&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"> 	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"> 	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="更新-1"><a href="#更新-1" class="headerlink" title="更新"></a>更新</h4><p>更新一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">updateOne</span>(&#123;<span class="attr">author</span>: <span class="string">&#x27;JJ Lin&#x27;</span>&#125;, &#123;<span class="attr">author</span>: <span class="string">&#x27;林俊杰&#x27;</span>&#125;, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量更新数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">updateMany</span>(&#123;<span class="attr">author</span>: <span class="string">&#x27;Leehom Wang&#x27;</span>&#125;, &#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h4><p>查询一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//根据 id 查询数据</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">findById</span>(<span class="string">&#x27;5dd662b5381fc316b44ce167&#x27;</span>,<span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量查询数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不加条件查询</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//加条件查询</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">find</span>(&#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="条件控制"><a href="#条件控制" class="headerlink" title="条件控制"></a>条件控制</h3><h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p>在 mongodb 不能 &gt; &lt; &gt;= &lt;= !== 等运算符，需要使用替代符号</p>
<ul>
<li><code>&gt;</code>使用 <code>$gt</code></li>
<li><code>&lt;</code> 使用 <code>$lt</code></li>
<li><code>=</code> 使用 <code>$gte</code></li>
<li><code>&lt;=</code> 使用 <code>$lte</code></li>
<li><code>!==</code> 使用 <code>$ne</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">students</span>.<span class="title function_">find</span>(&#123;<span class="attr">id</span>:&#123;<span class="attr">$gt</span>:<span class="number">3</span>&#125;&#125;); id号比<span class="number">3</span>大的所有的记录</span><br><span class="line"></span><br><span class="line"><span class="comment">// 价格小于 20 的图书</span></span><br><span class="line"><span class="title class_">BookModel</span>.<span class="title function_">find</span>(&#123; <span class="attr">price</span>: &#123; <span class="attr">$lt</span>: <span class="number">20</span> &#125; &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取失败~~~&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p><code>$or</code> 逻辑或的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">students</span>.<span class="title function_">find</span>(&#123;<span class="attr">$or</span>:[&#123;<span class="attr">age</span>:<span class="number">18</span>&#125;,&#123;<span class="attr">age</span>:<span class="number">24</span>&#125;]&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 曹雪芹 或者 余华的书</span></span><br><span class="line"><span class="title class_">BookModel</span>.<span class="title function_">find</span>(&#123; <span class="attr">$or</span>: [&#123; <span class="attr">author</span>: <span class="string">&#x27;曹雪芹&#x27;</span> &#125;, &#123; <span class="attr">author</span>: <span class="string">&#x27;余华&#x27;</span> &#125;] &#125;, <span class="function">(<span class="params">err, data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取失败~~~&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>$and</code> 逻辑与的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">students</span>.<span class="title function_">find</span>(&#123;<span class="attr">$and</span>: [&#123;<span class="attr">age</span>: &#123;<span class="attr">$lt</span>:<span class="number">20</span>&#125;&#125;, &#123;<span class="attr">age</span>: &#123;<span class="attr">$gt</span>: <span class="number">15</span>&#125;&#125;]&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 价格大于 30 且 小于 70</span></span><br><span class="line"><span class="title class_">BookModel</span>.<span class="title function_">find</span>(&#123; <span class="attr">$and</span>: [&#123; <span class="attr">price</span>: &#123; <span class="attr">$gt</span>: <span class="number">30</span> &#125; &#125;, &#123; <span class="attr">price</span>: &#123; <span class="attr">$lt</span>: <span class="number">70</span> &#125; &#125;] &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取失败~~~&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h4><p>条件中可以直接使用 JS 的正则语法，通过正则可以进行模糊查询</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">students</span>.<span class="title function_">find</span>(&#123;<span class="attr">name</span>:<span class="regexp">/imissyou/</span>&#125;);</span><br><span class="line"></span><br><span class="line">正则表达式，搜索书籍名称中带有 <span class="string">&#x27;三&#x27;</span> 的图书</span><br><span class="line"><span class="title class_">BookModel</span>.<span class="title function_">find</span>(&#123; <span class="attr">name</span>: <span class="regexp">/三/</span> &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取失败~~~&#x27;</span>)</span><br><span class="line">      	<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">BookModel</span>.<span class="title function_">find</span>(&#123; <span class="attr">name</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;三&#x27;</span>) &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line"> 	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">      	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取失败~~~&#x27;</span>)</span><br><span class="line">      	<span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="个性化读取"><a href="#个性化读取" class="headerlink" title="个性化读取"></a>个性化读取</h3><h4 id="字段筛选"><a href="#字段筛选" class="headerlink" title="字段筛选"></a>字段筛选</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0:不要的字段</span></span><br><span class="line"><span class="comment">//1:要的字段</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">find</span>().<span class="title function_">select</span>(&#123;<span class="attr">_id</span>:<span class="number">0</span>,<span class="attr">title</span>:<span class="number">1</span>&#125;).<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err,data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="数据排序"><a href="#数据排序" class="headerlink" title="数据排序"></a>数据排序</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sort 排序</span></span><br><span class="line"><span class="comment">// 1:升序</span></span><br><span class="line"><span class="comment">// -1:倒序</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">find</span>().<span class="title function_">sort</span>(&#123;<span class="attr">hot</span>:<span class="number">1</span>&#125;).<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err,data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="数据截取"><a href="#数据截取" class="headerlink" title="数据截取"></a>数据截取</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//skip 跳过   limit 限定</span></span><br><span class="line"><span class="title class_">SongModel</span>.<span class="title function_">find</span>().<span class="title function_">skip</span>(<span class="number">10</span>).<span class="title function_">limit</span>(<span class="number">10</span>).<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err,data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">	mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="图形化管理工具"><a href="#图形化管理工具" class="headerlink" title="图形化管理工具"></a>图形化管理工具</h2><p>我们可以使用图形化的管理工具来对 Mongodb 进行交互，这里演示两个图形化工具</p>
<ul>
<li>Robo 3T 免费 <a target="_blank" rel="noopener" href="https://github.com/Studio3T/robomongo/releases">https://github.com/Studio3T/robomongo/releases</a></li>
<li>Navicat 收费 <a target="_blank" rel="noopener" href="https://www.navicat.com.cn/">https://www.navicat.com.cn/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/02/MongoDB/" data-id="clm52imvt0007c4wpgwj8dlcg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-express框架" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/express%E6%A1%86%E6%9E%B6/" class="article-date">
  <time datetime="2023-06-02T15:32:34.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/express%E6%A1%86%E6%9E%B6/">express框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="express-介绍"><a href="#express-介绍" class="headerlink" title="express 介绍"></a>express 介绍</h2><blockquote>
<p>express 是一个基于 Node.js 平台的极简、灵活的 WEB 应用开发框架，官方网址： <a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/">https://www.expressjs.com.cn/</a></p>
</blockquote>
<p>简单来说，express 是一个封装好的工具包，封装了很多功能，便于我们开发 WEB 应用(HTTP 服务)</p>
<h2 id="express-使用"><a href="#express-使用" class="headerlink" title="express 使用"></a>express 使用</h2><h3 id="express-下载"><a href="#express-下载" class="headerlink" title="express 下载"></a>express 下载</h3><p>express 本身是一个 npm 包，所以可以通过 npm 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm i express</span><br></pre></td></tr></table></figure>

<h3 id="express-初体验"><a href="#express-初体验" class="headerlink" title="express 初体验"></a>express 初体验</h3><p>大家可以按照这个步骤进行操作：</p>
<ol>
<li>创建 JS 文件，键入如下代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//2. 创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//3. 创建路由规则</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">end</span>(<span class="string">&#x27;hello express server&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4. 监听端口 启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已经启动, 端口监听为 3000...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>命令行下执行该脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. node &lt;文件名&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">nodemon &lt;文件名&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>然后在浏览器就可以访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/home">http://127.0.0.1:3000/home</a> 👌</p>
</li>
</ol>
<h2 id="express-路由"><a href="#express-路由" class="headerlink" title="express 路由"></a>express 路由</h2><h3 id="什么是路由"><a href="#什么是路由" class="headerlink" title="什么是路由"></a>什么是路由</h3><blockquote>
<p>官方定义： <code>&lt;span style=&quot;color:red&quot;&gt;</code>路由确定了应用程序如何响应客户端对特定端点的请求</p>
</blockquote>
<h3 id="路由的使用"><a href="#路由的使用" class="headerlink" title="路由的使用"></a>路由的使用</h3><p>一个路由的组成有 <code>请求方法</code>， <code>路径</code> 和 <code>回调函数</code> 组成</p>
<p>express 中提供了一系列方法，可以很方便的使用路由，使用格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.&lt;method&gt;(path，callback)</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建 get 路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;网站首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//首页路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;我才是真正的首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建 post 路由</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;登录成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//匹配所有的请求方法</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;1 秒钟为您找到相关结果约 100,000,000 个&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义 404 路由</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&quot;*&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口 启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已经启动, 端口监听为 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取请求参数"><a href="#获取请求参数" class="headerlink" title="获取请求参数"></a>获取请求参数</h3><p>express 框架封装了一些 API 来方便获取请求报文中的数据，并且兼容原生 HTTP 模块的获取方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取请求的路由规则</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 1. 获取报文的方式与原生 HTTP 获取方式是兼容的</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">method</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">httpVersion</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">headers</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. express 独有的获取报文的方式</span></span><br><span class="line">    <span class="comment">// 获取路径</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">path</span>)</span><br><span class="line">    <span class="comment">//获取查询字符串</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>); <span class="comment">// 『相对重要』对象形式返回所有的查询字符串</span></span><br><span class="line">	<span class="comment">// 获取指定的请求头</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="title function_">get</span>(<span class="string">&#x27;host&#x27;</span>));</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;请求报文的获取&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;启动成功....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="获取路由参数"><a href="#获取路由参数" class="headerlink" title="获取路由参数"></a>获取路由参数</h3><p>路由参数指的是 <code>&lt;span style=&quot;color:red&quot;&gt;</code>URL 路径中的参数（数据）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/:id.html&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;商品详情, 商品 id 为&#x27;</span> + req.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="express-响应设置"><a href="#express-响应设置" class="headerlink" title="express 响应设置"></a>express 响应设置</h2><p>express 框架封装了一些 API 来方便给客户端响应数据，并且兼容原生 HTTP 模块的获取方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求的路由规则</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/response&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">//1. express 中设置响应的方式兼容 HTTP 模块的方式</span></span><br><span class="line">  	res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">  	res.<span class="property">statusMessage</span> = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">  	res.<span class="title function_">setHeader</span>(<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;xyz&#x27;</span>);</span><br><span class="line">  	res.<span class="title function_">write</span>(<span class="string">&#x27;响应体&#x27;</span>);</span><br><span class="line">  	res.<span class="title function_">end</span>(<span class="string">&#x27;xxx&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//2. express 的响应方法</span></span><br><span class="line">  	res.<span class="title function_">status</span>(<span class="number">500</span>); <span class="comment">//设置响应状态码</span></span><br><span class="line">  	res.<span class="title function_">set</span>(<span class="string">&#x27;xxx&#x27;</span>,<span class="string">&#x27;yyy&#x27;</span>);<span class="comment">//设置响应头</span></span><br><span class="line">  	res.<span class="title function_">send</span>(<span class="string">&#x27;中文响应不乱码&#x27;</span>);<span class="comment">//设置响应体</span></span><br><span class="line">  	<span class="comment">//连贯操作</span></span><br><span class="line">  	res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">set</span>(<span class="string">&#x27;xxx&#x27;</span>,<span class="string">&#x27;yyy&#x27;</span>).<span class="title function_">send</span>(<span class="string">&#x27;你好朋友&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//3. 其他响应</span></span><br><span class="line">  	res.<span class="title function_">redirect</span>(<span class="string">&#x27;http://atguigu.com&#x27;</span>)<span class="comment">//重定向</span></span><br><span class="line">  	res.<span class="title function_">download</span>(<span class="string">&#x27;./package.json&#x27;</span>);<span class="comment">//下载响应</span></span><br><span class="line">  	res.<span class="title function_">json</span>();<span class="comment">//响应 JSON</span></span><br><span class="line">  	res.<span class="title function_">sendFile</span>(__dirname + <span class="string">&#x27;/home.html&#x27;</span>) <span class="comment">//响应文件内容</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="express-中间件"><a href="#express-中间件" class="headerlink" title="express 中间件"></a>express 中间件</h2><h3 id="什么是中间件"><a href="#什么是中间件" class="headerlink" title="什么是中间件"></a>什么是中间件</h3><p><code>中间件（Middleware）本质是一个回调函数</code></p>
<p><code>中间件函数</code> 可以像路由回调一样访问 <code>请求对象（request）</code> ， <code>响应对象（response）</code></p>
<h3 id="中间件的作用"><a href="#中间件的作用" class="headerlink" title="中间件的作用"></a>中间件的作用</h3><p><code>中间件的作用</code> 就是 <code>使用函数封装公共操作，简化代码</code></p>
<h3 id="中间件的类型"><a href="#中间件的类型" class="headerlink" title="中间件的类型"></a>中间件的类型</h3><p>  全局中间件<br>  路由中间件</p>
<h4 id="定义全局中间件"><a href="#定义全局中间件" class="headerlink" title="定义全局中间件"></a>定义全局中间件</h4><p><code>每一个请求</code> 到达服务端之后 <code>都会执行全局中间件函数</code></p>
<p>声明中间件函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> recordMiddleware = <span class="keyword">function</span>(<span class="params">request,response,next</span>)&#123;</span><br><span class="line">  <span class="comment">//实现功能代码</span></span><br><span class="line">  <span class="comment">//.....</span></span><br><span class="line">  <span class="comment">//执行next函数(当如果希望执行完中间件函数之后，仍然继续执行路由中的回调函数，必须调用next)</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="./assets/34b8a3daffba5b366afb6495e4808b12de732403.jpg" alt="08_express框架"></p>
<p>应用中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(recordMiddleware)</span><br></pre></td></tr></table></figure>

<p>声明时可以直接将匿名函数传递给 <code>use</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">request, response, next</span>) &#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;定义第一个中间件&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="多个全局中间件"><a href="#多个全局中间件" class="headerlink" title="多个全局中间件"></a>多个全局中间件</h4><p>express 允许使用 app.use() 定义多个全局中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">request, response, next</span>) &#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;定义第一个中间件&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">request, response, next</span>) &#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;定义第二个中间件&#x27;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="定义路由中间件"><a href="#定义路由中间件" class="headerlink" title="定义路由中间件"></a>定义路由中间件</h4><p>如果<code>&lt;span style=&quot;color:red&quot;&gt;</code>只需要对某一些路由进行功能封装，则就需要路由中间件</p>
<p>调用格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/路径&#x27;</span>,<span class="string">`中间件函数`</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/路径&#x27;</span>,<span class="string">`中间件函数1`</span>,<span class="string">`中间件函数2`</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="静态资源中间件"><a href="#静态资源中间件" class="headerlink" title="静态资源中间件"></a>静态资源中间件</h3><p>express 内置处理静态资源的中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//创建服务对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//静态资源中间件的设置，将当前文件夹下的public目录作为网站的根目录</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;./public&#x27;</span>)); <span class="comment">//当然这个目录中都是一些静态资源</span></span><br><span class="line"><span class="comment">//如果访问的内容经常变化，还是需要设置路由</span></span><br><span class="line"><span class="comment">//但是，在这里有一个问题，如果public目录下有index.html文件，单独也有index.html的路由</span></span><br><span class="line"><span class="comment">//则谁书写在前，优先执行谁</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/index.html&#x27;</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	respsonse.<span class="title function_">send</span>(<span class="string">&#x27;首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//监听端口</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3000 端口启动....&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项:</p>
<ol>
<li>index.html 文件为默认打开的资源</li>
<li>如果静态资源与路由规则同时匹配，谁先匹配谁就响应</li>
<li>路由响应动态资源，静态资源中间件响应静态资源</li>
</ol>
</blockquote>
<h3 id="获取请求体数据-body-parser"><a href="#获取请求体数据-body-parser" class="headerlink" title="获取请求体数据 body-parser"></a>获取请求体数据 body-parser</h3><p>express 可以使用 <code>body-parser</code> 包处理请求体</p>
<p>第一步：安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i body-parser</span><br></pre></td></tr></table></figure>

<p>第二步：导入 body-parser 包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>第三步：获取中间件函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理 querystring 格式的请求体</span></span><br><span class="line"><span class="keyword">let</span> urlParser = bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;));</span><br><span class="line"><span class="comment">//处理 JSON 格式的请求体</span></span><br><span class="line"><span class="keyword">let</span> jsonParser = bodyParser.<span class="title function_">json</span>();</span><br></pre></td></tr></table></figure>

<p>第四步：设置路由中间件，然后使用 <code>request.body</code> 来获取请求体数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, urlParser, <span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//获取请求体数据</span></span><br><span class="line">	<span class="comment">//console.log(request.body);</span></span><br><span class="line">	<span class="comment">//用户名</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">body</span>.<span class="property">username</span>);</span><br><span class="line"> 	<span class="comment">//密码</span></span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">body</span>.<span class="property">userpass</span>);</span><br><span class="line">  	response.<span class="title function_">send</span>(<span class="string">&#x27;获取请求体数据&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取到的请求体数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="title class_">Object</span>: <span class="literal">null</span> prototype] &#123; <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="attr">userpass</span>: <span class="string">&#x27;123456&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong> 现在你已经可以抛弃 body-parser 模块，因为 Express 自从 4.16.0 版本开始，内置了 body 解析</p>
<p><strong>使用方法:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 解析 JSON 格式的请求体的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line"><span class="comment">// 解析 querystring 格式请求体的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure>

<h2 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h2><h3 id="什么是-Router"><a href="#什么是-Router" class="headerlink" title="什么是 Router"></a>什么是 Router</h3><p>express 中的 Router 是一个完整的中间件和路由系统，可以看做是一个小型的 app 对象。</p>
<h3 id="Router-作用"><a href="#Router-作用" class="headerlink" title="Router 作用"></a>Router 作用</h3><p>对路由进行模块化，更好的管理路由</p>
<h3 id="Router-使用"><a href="#Router-使用" class="headerlink" title="Router 使用"></a>Router 使用</h3><p>创建独立的 JS 文件（homeRouter.js）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 创建路由器对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 在 router 对象身上添加路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;首页&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/cart&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">send</span>(<span class="string">&#x27;购物车&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 暴露</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>主文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//5.引入子路由文件</span></span><br><span class="line"><span class="keyword">const</span> homeRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/homeRouter&#x27;</span>);</span><br><span class="line"><span class="comment">//6.设置和使用中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(homeRouter);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3000 端口启动....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="EJS-模板引擎"><a href="#EJS-模板引擎" class="headerlink" title="EJS 模板引擎"></a>EJS 模板引擎</h2><h3 id="什么是模板引擎"><a href="#什么是模板引擎" class="headerlink" title="什么是模板引擎"></a>什么是模板引擎</h3><p>模板引擎是分离 <code>&lt;span style=&quot;color:red&quot;&gt;</code>用户界面和业务数据 的一种技术</p>
<h3 id="什么是-EJS"><a href="#什么是-EJS" class="headerlink" title="什么是 EJS"></a>什么是 EJS</h3><p>EJS 是一个高效的 Javascript 的模板引擎<br>官网: <a target="_blank" rel="noopener" href="https://ejs.co/">https://ejs.co/</a><br>中文站： <a target="_blank" rel="noopener" href="https://ejs.bootcss.com/">https://ejs.bootcss.com/</a></p>
<h3 id="EJS-初体验"><a href="#EJS-初体验" class="headerlink" title="EJS 初体验"></a>EJS 初体验</h3><p>下载安装EJS</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i ejs --save</span><br></pre></td></tr></table></figure>

<p>代码示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.引入ejs</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">//2.定义数据</span></span><br><span class="line"><span class="keyword">let</span> person = [<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王二麻子&#x27;</span>];</span><br><span class="line"><span class="comment">//3.ejs解析模板返回结构</span></span><br><span class="line"><span class="comment">//&lt;%= %&gt; 是ejs解析内容的标记，作用是输出当前表达式的执行结构</span></span><br><span class="line"><span class="comment">//&quot;&lt;%= %&gt;&quot;可以直接输出变量或表达式的值，变量或表达式的值将作为一个字符串在浏览器中输出。</span></span><br><span class="line"><span class="keyword">let</span> html = ejs.<span class="title function_">render</span>(‘&lt;%= person.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>) %&gt;’, &#123;<span class="attr">person</span>:person&#125;);</span><br><span class="line"><span class="comment">//4.输出结果</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(html);</span><br></pre></td></tr></table></figure>

<p>命令行下运行</p>
<h3 id="EJS-常用语法"><a href="#EJS-常用语法" class="headerlink" title="EJS 常用语法"></a>EJS 常用语法</h3><p>执行JS代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% code %&gt;</span><br></pre></td></tr></table></figure>

<p>输出转义的数据到模板上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= code %&gt;</span><br></pre></td></tr></table></figure>

<p>输出非转义的数据到模板上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- code %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="在express中使用ejs"><a href="#在express中使用ejs" class="headerlink" title="在express中使用ejs"></a>在express中使用ejs</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 1. 设置模板引擎</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>)  <span class="comment">// pug  twing</span></span><br><span class="line"><span class="comment">// 2. 设置模板文件的存放位置</span></span><br><span class="line"><span class="comment">// 模板文件: 具有模板语法内容的文件</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./views&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 3. render 响应</span></span><br><span class="line">  <span class="comment">// res.render(&#x27;模板的文件名&#x27;,&#x27;数据&#x27;)</span></span><br><span class="line">  <span class="keyword">let</span> title = <span class="string">&#x27;尚硅谷 - 让天下没有难学的技术&#x27;</span></span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, &#123; title &#125;)</span><br><span class="line">  <span class="comment">// 4. 创建模板文件</span></span><br><span class="line">  <span class="comment">// 如下面文件 views/home.ejs</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口，启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器已启动~~~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>views/home.ejs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h2&gt;</span><br><span class="line">    &lt;%=title %&gt;</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/02/express%E6%A1%86%E6%9E%B6/" data-id="clm52imvt0008c4wp6ptnfhc4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-会话控制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6/" class="article-date">
  <time datetime="2023-06-02T15:32:34.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6/">会话控制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="会话控制"><a href="#会话控制" class="headerlink" title="会话控制"></a>会话控制</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>所谓会话控制就是 <code>&lt;span style=&quot;color:red&quot;&gt;</code>对会话进行控制</p>
</blockquote>
<p>HTTP 是一种无状态的协议，它没有办法区分多次的请求是否来自于同一个客户端，<code>&lt;span style=&quot;color:red&quot;&gt;</code>无法区分用户</p>
<p>而产品中又大量存在的这样的需求，所以我们需要通过 <code>&lt;span style=&quot;color:red&quot;&gt;</code>会话控制 来解决该问题</p>
<p>常见的会话控制技术有三种：</p>
<ul>
<li>cookie</li>
<li>session</li>
<li>token</li>
</ul>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><h3 id="cookie-是什么"><a href="#cookie-是什么" class="headerlink" title="cookie 是什么"></a>cookie 是什么</h3><blockquote>
<p>cookie 是 HTTP 服务器发送到用户浏览器并保存在本地的一小块数据</p>
</blockquote>
<p><code>&lt;span style=&quot;color:red&quot;&gt;</code>cookie 是保存在浏览器端的一小块数据</p>
<p><code>&lt;span style=&quot;color:red&quot;&gt;</code>cookie 是按照域名划分保存的</p>
<p>简单示例：</p>
<table>
<thead>
<tr>
<th>域名</th>
<th>cookie</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></td>
<td>a=100; b=200</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.bilibili.com/">www.bilibili.com</a></td>
<td>xid=1020abce121; hm=112411213</td>
</tr>
<tr>
<td>jd.com</td>
<td>x=100; ocw=12414cce</td>
</tr>
</tbody></table>
<h3 id="cookie-的特点"><a href="#cookie-的特点" class="headerlink" title="cookie 的特点"></a>cookie 的特点</h3><p>浏览器向服务器发送请求时，会自动将 <code>当前域名下</code> 可用的 cookie 设置在请求头中，然后传递给服务器</p>
<p><img src="./assets/2432689d3a6913a8952b0e2f7c13b6aa468fe9ce.jpg" alt="11_会话控制"></p>
<p>这个请求头的名字也叫 <code>cookie</code> ，所以将 <code>&lt;span style=&quot;color:red&quot;&gt;</code>cookie 理解为一个 HTTP 的请求头也是可以的</p>
<h3 id="cookie-的运行流程"><a href="#cookie-的运行流程" class="headerlink" title="cookie 的运行流程"></a>cookie 的运行流程</h3><p>填写账号和密码校验身份，校验通过后下发 cookie</p>
<p><img src="./assets/f65d061b87c7b44dbddc1e9703146f9e03482aea.png" alt="image-20230327214116490"><br>有了 cookie 之后，后续向服务器发送请求时，就会自动携带 cookie</p>
<p><img src="./assets/82caab8f82650a12b76b9085e3d7b5c44a725ee8.png" alt="image-20230327214554199"></p>
<h3 id="浏览器操作-cookie"><a href="#浏览器操作-cookie" class="headerlink" title="浏览器操作 cookie"></a>浏览器操作 cookie</h3><p>浏览器操作 cookie 的操作，使用相对较少，大家了解即可</p>
<ol>
<li>禁用所有 cookie</li>
<li>删除 cookie</li>
<li>查看 cookie</li>
</ol>
<h3 id="cookie-的代码操作"><a href="#cookie-的代码操作" class="headerlink" title="cookie 的代码操作"></a>cookie 的代码操作</h3><p>express 中可以使用 <code>cookie-parser</code> 进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express =<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//1. 安装 cookie-parser	 npm i cookie-parser</span></span><br><span class="line"><span class="comment">//2. 引入 cookieParser 包</span></span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 设置 cookieParser 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">  </span><br><span class="line"><span class="comment">//4-1 设置 cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/set-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 不带时效性    会在浏览器关闭的时候，销毁</span></span><br><span class="line">	response.<span class="title function_">cookie</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>);</span><br><span class="line">  	<span class="comment">// 带时效性</span></span><br><span class="line">  	response.<span class="title function_">cookie</span>(<span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;23123456@qq.com&#x27;</span>, &#123;<span class="attr">maxAge</span>: <span class="number">5</span>*<span class="number">60</span>*<span class="number">1000</span> &#125;);</span><br><span class="line">  	<span class="comment">//响应</span></span><br><span class="line">  	response.<span class="title function_">send</span>(<span class="string">&#x27;Cookie的设置&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4-2 读取 cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/get-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取 cookie</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">cookies</span>);</span><br><span class="line">  	<span class="comment">//响应体</span></span><br><span class="line">  	response.<span class="title function_">send</span>(<span class="string">&#x27;Cookie的读取&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4-3 删除cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/delete-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">	response.<span class="title function_">clearCookie</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">	<span class="comment">//响应</span></span><br><span class="line">	response.<span class="title function_">send</span>(<span class="string">&#x27;cookie 的清除&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已经启动....&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不同浏览器中的 cookie 是相互独立的，不共享</p>
</blockquote>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h3 id="session-是什么"><a href="#session-是什么" class="headerlink" title="session 是什么"></a>session 是什么</h3><p>session 是保存在 <code>&lt;span style=&quot;color:red&quot;&gt;</code>服务器端的一块儿数据，保存当前访问用户的相关信息</p>
<h3 id="session-的作用"><a href="#session-的作用" class="headerlink" title="session 的作用"></a>session 的作用</h3><p>实现会话控制，可以识别用户的身份，快速获取当前用户的相关信息</p>
<h3 id="session-运行流程"><a href="#session-运行流程" class="headerlink" title="session 运行流程"></a>session 运行流程</h3><p>填写账号和密码校验身份，校验通过后创建 <code>session 信息</code>，然后将 <code>session_id</code> 的值通过响应头返回给浏览器</p>
<p><img src="./assets/b85539cfe706e14c1b8e3c951169ef818af4f247.png" alt="image-20230327222810111"></p>
<p>有了cookie，下次发送请求时会自动携带cookie，服务器通过 <code>cookie</code> 中的 <code>session_id</code> 的值确定用<br>户的身份</p>
<p><img src="./assets/58c03619b70c2ecc76ac8684691a30fe977f59c1.png" alt="image-20230327223550720"></p>
<h3 id="session-的代码操作"><a href="#session-的代码操作" class="headerlink" title="session 的代码操作"></a>session 的代码操作</h3><p>express 中可以使用 <code>express-session</code> 对 session 进行操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//1. 安装包 npm i express-session connect-mongo</span></span><br><span class="line"><span class="comment">//2. 引入 express-session connect-mongo</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MongoStore</span> = <span class="built_in">require</span>(<span class="string">&#x27;connect-mongo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 设置 session 的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;sid&#x27;</span>, <span class="comment">//设置cookie的name，默认值是：connect.sid</span></span><br><span class="line">	<span class="attr">secret</span>: <span class="string">&#x27;atguigu&#x27;</span>, <span class="comment">//参与加密的字符串（又称签名）  加盐</span></span><br><span class="line">	<span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">//是否为每次请求都设置一个cookie用来存储session的id</span></span><br><span class="line">	<span class="attr">resave</span>: <span class="literal">true</span>, <span class="comment">//是否在每次请求时重新保存session</span></span><br><span class="line">	<span class="attr">store</span>: <span class="title class_">MongoStore</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">		<span class="attr">mongoUrl</span>: <span class="string">&#x27;mongodb://127.0.0.1:27017/project&#x27;</span> <span class="comment">//数据库的连接配置</span></span><br><span class="line">	&#125;),</span><br><span class="line">	<span class="attr">cookie</span>: &#123;</span><br><span class="line">		<span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="comment">// 开启后前端无法通过 JS 操作</span></span><br><span class="line">		<span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">300</span> <span class="comment">// 这一条 是控制 sessionID 的过期时间的！！！</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建 session  session的设置</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//设置session</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="property">username</span> = <span class="string">&#x27;zhangsan&#x27;</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">email</span> = <span class="string">&#x27;zhangsan@qq.com&#x27;</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;登录成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取 session</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;session的信息&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>.<span class="property">username</span>);</span><br><span class="line">    <span class="comment">// 检测 session 是否存在用户数据</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">username</span>) &#123;</span><br><span class="line">    	res.<span class="title function_">send</span>(<span class="string">`你好 <span class="subst">$&#123;req.session.username&#125;</span>`</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	res.<span class="title function_">send</span>(<span class="string">&#x27;登录 注册&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//销毁 session</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//销毁session</span></span><br><span class="line">    <span class="comment">// res.send(&#x27;设置session&#x27;);</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">destroy</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	res.<span class="title function_">send</span>(<span class="string">&#x27;成功退出&#x27;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已经启动, 端口 &#x27;</span> + <span class="number">3000</span> + <span class="string">&#x27; 监听中...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="session-和-cookie-的区别"><a href="#session-和-cookie-的区别" class="headerlink" title="session 和 cookie 的区别"></a>session 和 cookie 的区别</h2><p>cookie 和 session 的区别主要有如下几点：</p>
<ol>
<li>存在的位置</li>
</ol>
<ul>
<li>cookie：浏览器端</li>
<li>session：服务端</li>
</ul>
<ol start="2">
<li>安全性</li>
</ol>
<ul>
<li>cookie 是以明文的方式存放在客户端的，安全性相对较低</li>
<li>session 存放于服务器中，所以安全性 <code>相对</code> 较好</li>
</ul>
<ol start="3">
<li>网络传输量</li>
</ol>
<ul>
<li>cookie 设置内容过多会增大报文体积， 会影响传输效率</li>
<li>session 数据存储在服务器，只是通过 cookie 传递 id，所以不影响传输效率</li>
</ul>
<ol start="4">
<li>存储限制</li>
</ol>
<ul>
<li>浏览器限制单个 cookie 保存的数据不能超过 <code>4K</code> ，且单个域名下的存储数量也有限制</li>
<li>session 数据存储在服务器中，所以没有这些限制</li>
</ul>
<h2 id="token"><a href="#token" class="headerlink" title="token"></a>token</h2><h3 id="token-是什么"><a href="#token-是什么" class="headerlink" title="token 是什么"></a>token 是什么</h3><p><code>token</code> 是服务端生成并返回给 HTTP 客户端的一串加密字符串， <code>token</code> 中保存着 <code>用户信息</code></p>
<p>token 不属于 http 标准，完全由前后端协商而定，但 cookie 属于 http 标准</p>
<h3 id="token-的作用"><a href="#token-的作用" class="headerlink" title="token 的作用"></a>token 的作用</h3><p>实现会话控制，可以识别用户的身份，主要用于移动端 APP</p>
<h3 id="token-的工作流程"><a href="#token-的工作流程" class="headerlink" title="token 的工作流程"></a>token 的工作流程</h3><p>填写账号和密码校验身份，校验通过后响应 token，token 一般是在响应体中返回给客户端的</p>
<p><img src="./assets/5e03daa442b749955aac291d68ffa22c3506ba86.png" alt="image-20230328135106885"><br>后续发送请求时，需要 <code>手动</code>将 token 添加在请求报文中(<code>&lt;span style=&quot;color:red&quot;&gt;</code>cookie是自动携带的)，一般是放在请求头中<br><img src="./assets/7e7369958050ccff563122b9618f09c28dae956b.png" alt="image-20230328135122945"></p>
<h3 id="token-的特点"><a href="#token-的特点" class="headerlink" title="token 的特点"></a>token 的特点</h3><ul>
<li><p>服务端压力更小</p>
<ul>
<li>数据存储在客户端</li>
</ul>
</li>
<li><p>相对更安全</p>
<ul>
<li>数据加密</li>
<li>可以避免 CSRF（跨站请求伪造）</li>
</ul>
</li>
<li><p>扩展性更强</p>
<ul>
<li>服务间可以共享</li>
<li>增加服务节点更简单</li>
</ul>
</li>
</ul>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><p>JWT（JSON Web Token ）是目前最流行的跨域认证解决方案，可用于基于 <code>token</code> 的身份验证</p>
<p>JWT 使 token 的生成与校验更规范</p>
<p>我们可以使用 <code>jsonwebtoken 包</code> 来操作 token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 jsonwebtokan</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建 token</span></span><br><span class="line"><span class="comment">// jwt.sign(数据, 加密字符串, 配置对象)</span></span><br><span class="line"><span class="keyword">let</span> token = jwt.<span class="title function_">sign</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line">&#125;, <span class="string">&#x27;atguigu&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">expiresIn</span>: <span class="number">60</span> <span class="comment">//单位是 秒</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析 token</span></span><br><span class="line"><span class="comment">// jwt.verify(token,加密字符串，回调函数)</span></span><br><span class="line">jwt.<span class="title function_">verify</span>(token, <span class="string">&#x27;atguigu&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;校验失败~~&#x27;</span>);</span><br><span class="line">	    <span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(data);<span class="comment">// &#123; username: &#x27;张三&#x27;, iat: (创建时间), exp:(过期时间)&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>扩展阅读： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p>
</blockquote>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="本地域名"><a href="#本地域名" class="headerlink" title="本地域名"></a>本地域名</h3><p>所谓本地域名就是 <code>&lt;span style=&quot;color:red&quot;&gt;</code>只能在本机使用的域名，一般在开发阶段使用</p>
<h4 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h4><p>编辑文件 <code>C:\Windows\System32\drivers\etc\hosts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   www.baidu.com</span><br></pre></td></tr></table></figure>

<p>如果修改失败，<code>&lt;span style=&quot;color:red&quot;&gt;</code>可以修改该文件的权限</p>
<p><img src="./assets/bfe2b3b80fe871577ca342891eef6201f352b682.jpg" alt="11_会话控制"></p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>在地址栏输入 <code>域名</code> 之后，浏览器会先进行 DNS（Domain Name System）查询，获取该域名对应的 IP 地<br>址<br>请求会发送到 DNS 服务器，可以 <code>根据域名返回 IP 地址</code></p>
<p>可以通过 <code>ipconfig /all</code> 查看本机的 DNS 服务器</p>
<p><code>hosts</code> 文件也可以设置域名与 IP 的映射关系，在发送请求前，可以通过该文件获取域名的 IP 地址</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/02/%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6/" data-id="clm52imw0000pc4wp2wer9i0v" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-接口" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/%E6%8E%A5%E5%8F%A3/" class="article-date">
  <time datetime="2023-06-02T15:32:34.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/%E6%8E%A5%E5%8F%A3/">接口</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="接口是什么"><a href="#接口是什么" class="headerlink" title="接口是什么"></a>接口是什么</h3><blockquote>
<p>接口是 <code>&lt;span style=&quot;color:red&quot;&gt;</code>前后端通信的桥梁</p>
</blockquote>
<p>简单理解：一个接口就是 <code>&lt;span style=&quot;color:red&quot;&gt;</code>服务中的一个路由规则 ，根据请求响应结果</p>
<p>接口的英文单词是 API (Application Program Interface)，所以有时也称之为 <code>API 接口</code></p>
<p>这里的接口指的是『数据接口』， <code>&lt;span style=&quot;color:red&quot;&gt;</code>与编程语言（Java，Go 等）中的接口语法不同</p>
<h3 id="接口的作用"><a href="#接口的作用" class="headerlink" title="接口的作用"></a>接口的作用</h3><blockquote>
<p>实现 <code>&lt;span style=&quot;color:red&quot;&gt;</code>前后端通信</p>
</blockquote>
<p><img src="./assets/b6836e5dc9b1f33ee5f030de2fd1780db7f2447c.png" alt="image-20230327163353386"></p>
<h3 id="接口的开发与调用"><a href="#接口的开发与调用" class="headerlink" title="接口的开发与调用"></a>接口的开发与调用</h3><p>大多数接口都是由 <code>&lt;span style=&quot;color:red&quot;&gt;</code>后端工程师 开发的， <code>&lt;span style=&quot;color:red&quot;&gt;</code>开发语言不限</p>
<p>一般情况下接口都是由 <code>&lt;span style=&quot;color:red&quot;&gt;</code>前端工程师 调用的，但有时 <code>&lt;span style=&quot;color:red&quot;&gt;</code>后端工程师也会调用接口 ，比如短信接口，支付接口<br>等</p>
<h3 id="接口的组成"><a href="#接口的组成" class="headerlink" title="接口的组成"></a>接口的组成</h3><p>一个接口一般由如下几个部分组成</p>
<ul>
<li>请求方法</li>
<li>接口地址（URL）</li>
<li>请求参数</li>
<li>响应结果</li>
</ul>
<p>一个接口示例 <a target="_blank" rel="noopener" href="https://www.free-api.com/doc/325">https://www.free-api.com/doc/325</a></p>
<p>体验一下： <a target="_blank" rel="noopener" href="https://api.asilu.com/idcard/?id=371522199111299668">https://api.asilu.com/idcard/?id=371522199111299668</a></p>
<h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><p>RESTful API 是一种特殊风格的接口，主要特点有如下几个：</p>
<ul>
<li>URL 中的路径表示 <code>&lt;span style=&quot;color:red&quot;&gt;</code>资源，路径中不能有 <code>动词</code>，例如 <code>create</code> , <code>delete</code> , <code>update</code> 等这些都不能有</li>
<li>操作资源要与 <code>HTTP 请求方法</code> 对应</li>
<li>操作结果要与 <code>HTTP 响应状态码</code> 对应</li>
</ul>
<p>规则示例：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>请求类型</th>
<th>URL</th>
<th>返回</th>
</tr>
</thead>
<tbody><tr>
<td>新增歌曲</td>
<td>POST</td>
<td>/song</td>
<td>返回新生成的歌曲信息</td>
</tr>
<tr>
<td>删除歌曲</td>
<td>DELETE</td>
<td>/song/10</td>
<td>返回一个空文档</td>
</tr>
<tr>
<td>修改歌曲</td>
<td>PUT</td>
<td>/song/10</td>
<td>返回更新后的歌曲信息</td>
</tr>
<tr>
<td>修改歌曲</td>
<td>PATCH</td>
<td>/song/10</td>
<td>返回更新后的歌曲信息</td>
</tr>
<tr>
<td>获取所有歌曲</td>
<td>GET</td>
<td>/song</td>
<td>返回歌曲列表数组</td>
</tr>
<tr>
<td>获取单个歌曲</td>
<td>GET</td>
<td>/song/10</td>
<td>返回单个歌曲信息</td>
</tr>
</tbody></table>
<blockquote>
<p>扩展阅读： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2014/05/restful_api.html">https://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p>
</blockquote>
<h2 id="json-server"><a href="#json-server" class="headerlink" title="json-server"></a>json-server</h2><p>json-server 本身是一个 JS 编写的工具包，可以快速搭建 RESTful API 服务</p>
<p>官方地址: <a target="_blank" rel="noopener" href="https://github.com/typicode/json-server">https://github.com/typicode/json-server</a></p>
<p>操作步骤：</p>
<ol>
<li><p>全局安装 <code>json-server</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g json-server</span><br></pre></td></tr></table></figure></li>
<li><p>创建 JSON 文件（db.json），编写基本结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;song&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;干杯&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;singer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;五月天&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;当&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;singer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;动力火车&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;不能说的秘密&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;singer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;周杰伦&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>以 JSON 文件所在文件夹作为工作目录</code>，执行如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json-server --watch db.json</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>默认监听端口为 <code>3000</code></p>
<h2 id="接口测试工具"><a href="#接口测试工具" class="headerlink" title="接口测试工具"></a>接口测试工具</h2><p>  介绍几个接口测试工具<br>  apipost <a target="_blank" rel="noopener" href="https://www.apipost.cn/">https://www.apipost.cn/</a> (中文)<br>  apifox <a target="_blank" rel="noopener" href="https://www.apifox.cn/">https://www.apifox.cn/</a> (中文)<br>  postman <a target="_blank" rel="noopener" href="https://www.postman.com/">https://www.postman.com/</a> (英文)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/02/%E6%8E%A5%E5%8F%A3/" data-id="clm52imw40011c4wpgmdo099b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-网络基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2023-06-02T15:32:34.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">网络基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="从输入URL到页面加载发生了什么？"><a href="#从输入URL到页面加载发生了什么？" class="headerlink" title="从输入URL到页面加载发生了什么？"></a>从输入URL到页面加载发生了什么？</h1><ol>
<li>浏览器查找当前URL是否存在缓存，并比较缓存是否过期。（先判断HTTP请求浏览器是否已缓存）</li>
</ol>
<p><strong>有缓存</strong></p>
<p>如为<strong>强制缓存</strong> ，通过 <code>Expires或Cache-Control：max-age</code>判断该缓存是否过期，未过期，直接使用该资源；Expires和max-age，如果两者同时存在，则被Cache-Control的max-age覆盖。</p>
<p>如为<strong>协商缓存</strong> ，请求头部带上相关信息如 <code>if-none-match（Etag）</code>与 <code>if-modified-since(last-modified)</code>，验证缓存是否有效，若有效则返回状态码为 <code>304</code>，若无效则重新返回资源，状态码为 <code>200</code></p>
<ol start="2">
<li>DNS解析URL对应的IP</li>
<li>根据IP建立TCP连接（三次握手）（<code>握手过程见下文</code>）</li>
<li>HTTP发起请求</li>
<li>服务器处理请求，浏览器接收HTTP响应</li>
<li>渲染页面，构建DOM树</li>
</ol>
<ul>
<li>HTML 解析，生成DOM树</li>
<li>根据 CSS 解析生成 CSS 树</li>
<li>结合 DOM 树和 CSS 规则树，生成渲染树</li>
<li>根据渲染树计算每一个节点的信息（layout布局）</li>
<li>根据计算好的信息绘制页面</li>
</ul>
<p>如果遇到 script 标签，则判断是否含有 defer 或者 async 属性，如果有，异步去下载该资源；如果没有设置，暂停dom的解析，去加载script的资源，然后执行该js代码（ <strong>script标签加载和执行会阻塞页面的渲染</strong> ）</p>
<ol start="7">
<li>关闭TCP连接（四次挥手）</li>
</ol>
<h1 id="http-https"><a href="#http-https" class="headerlink" title="http/https"></a>http/https</h1><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>http协议又叫超文本传输协议，它是应用层中使用最多的协议，</p>
<p>http与我们常说的socket有什么区别吗？</p>
<p>我们使用的网络可以分为（会话层和表示层可以忽略），每一层使用下一层的功能，并为上一层提供接口，我们经常听说的http协议就是应用层的协议，其中应用层协议包括ftp等等，而应用层还需要使用传输层的协议，http使用的就是tcp协议，http3计划使用udp协议。不过不管是tcp还是udp都是使用网络层的ip协议。不过传输层及以下层都是在操作系统内核中的，不利于我们使用，所以在用户态设计了socket接口来帮助我们使用tcp或者udp的网络协议。而http协议则是已经定义好解析标准的能让我们直接使用的协议。</p>
<h3 id="http1-0"><a href="#http1-0" class="headerlink" title="http1.0"></a>http1.0</h3><p>http1.0是个短连接，即每发一次请求，就建立一次连接，一次响应后就释放连接，这种方式简化了http的请求响应，但是却造成了重大的浪费：不能并行请求，每次请求都需要建立连接和释放连接，导致每次请求都需要三次握手和四次挥手。</p>
<h3 id="http1-1"><a href="#http1-1" class="headerlink" title="http1.1"></a>http1.1</h3><ol>
<li>长连接: 每个连接完成一次请求后先不关闭，在一定时间内可以发送多次请求。通过设置请求头<em>Connection: keep-alive</em>来实现。</li>
<li>管道化技术: 虽然长连接减少了握手消耗，但是每次都要前一次请求完成之后才能发送下一次请求，管道化技术允许在一个请求没有响应之前发送多次请求。不过管道话技术要求响应必须按照请求发送的顺序返回，否则无法解析。存在队头阻塞。实际使用不多。</li>
</ol>
<h3 id="http2"><a href="#http2" class="headerlink" title="http2"></a>http2</h3><ol>
<li>二进制分帧：http2设计出了二进制分帧技术，http1中的数据都是通过文本文本传输的，但是二进制结构更有利于数据处理，因为计算机只认识二进制，所以传输时不需要文本与二进制之间的转换。</li>
<li>http1中的管道技术虽然支持反多次请求，但是响应必须按照顺序返回，不能实现真正的并发，存在队头阻塞问题。针对这个问题，http2将每个响应分成若干个帧序列，而每个帧序列都有流号，标记属于哪个响应，这样即使每个帧序列乱序到客户端，还是能够根据流id重新组装，解决了http方面的队头阻塞，真正实现多路复用。</li>
<li>头部压缩：在大多数时候，我们请求或者响应的数据可能很少（例如ajax请求），但是同样需要传输各种请求头，尤其是cookie。这无疑给http带来负担，而头部压缩就是解决重复请求头发送的问题。</li>
<li>服务器推送：在http1中，上一个响应发送完了，服务器才能发送下一个请求，但在http2里，可以将多个响应一起发送。例如在一个html文件中有个多js，css文件，为了快速解析页面，可以直接向客户端推送js文件，从而减少客户端请求的时间。</li>
</ol>
<p>http2存在的缺陷：http2虽然实现了多路复用，但是并没有解决tcp方面的队头阻塞。而且，同一个连接内多个流传输，可能会导致响应事件时间变长，相比http1容易出现超时重传；再者，h2适合于大量冗余的请求，对于少量请求并没有太大优势。</p>
<h3 id="http3"><a href="#http3" class="headerlink" title="http3"></a>http3</h3><p>http3协议使用udp为传输层协议，udp不需要握手就可以直接发送数据，因此udp是不可靠的传输层协议，所以就需要自己实现tcp的流量控制和拥塞控制。</p>
<h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><p>http协议都是明文传输的，而且不会对应用数据和主机进行验证，这样即使数据被窃取和篡改我们也不得而知，所以为了保证http的安全，在它的基础上加了TSL/SSL安全协议。形成了我们所说的https协议。</p>
<p><img src="1.png" alt="1685723109077"></p>
<p>http之所以不安全最大的原因就是使用明文传输，所以加密成了最大的问题，目前分为两大类加密算法。</p>
<ul>
<li>对称加密：DES(分组加密算法)，AES(可以看作是DES的升级版)</li>
<li>非对称加密：RSA、DSA</li>
</ul>
<p><img src="2.png" alt="1685723237404"></p>
<p>由于目前公钥加密算法的开销比较大，所以一般采用对称加密来保密信息。但是对称加密过程，密钥如何传输？这时可以使用公私钥来进行传输，因为公私钥使用公钥加密，私钥解密，所以只要是对方公钥加密的数据只有对方的私钥才能解密。</p>
<h2 id="http和https的区别"><a href="#http和https的区别" class="headerlink" title="http和https的区别"></a>http和https的区别</h2><ol>
<li><p>安全角度</p>
<p>http属于明文传输协议，https属于加密传输协议，传输的数据需要经过SSL/TLS加密，因此有更高的安全性。</p>
</li>
<li><p>端口角度</p>
<p>http: 80; https: 443</p>
</li>
<li><p>加密与证书角度</p>
<p>http不需要向服务端申请证书</p>
<p>https在TCP三次握手后，需要进行SSL的握手，协商加密使用的对称加密密钥，还需要向服务端申请证书，浏览器安装对应的根证书。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/02/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" data-id="clm52imwa001hc4wp8j9h61mi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-手写源代码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/05/30/%E6%89%8B%E5%86%99%E6%BA%90%E4%BB%A3%E7%A0%81/" class="article-date">
  <time datetime="2023-05-30T07:23:39.000Z" itemprop="datePublished">2023-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/05/30/%E6%89%8B%E5%86%99%E6%BA%90%E4%BB%A3%E7%A0%81/">手写源代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="数组去重"><a href="#数组去重" class="headerlink" title="数组去重"></a>数组去重</h1><h2 id="使用双重-for-和-splice"><a href="#使用双重-for-和-splice" class="headerlink" title="使用双重 for 和 splice"></a>使用双重 for 和 splice</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;arr.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j= i+<span class="number">1</span>;j&lt;arr.<span class="property">length</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]===arr[j])&#123;</span><br><span class="line">                <span class="comment">// 删除第二个</span></span><br><span class="line">                arr.<span class="title function_">splice</span>(j,<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 删除后回调j</span></span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line">a=[<span class="number">1</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="title function_">unique</span>(a);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<h2 id="使用-indexOf-或-includes-加新数组"><a href="#使用-indexOf-或-includes-加新数组" class="headerlink" title="使用 indexOf 或 includes 加新数组"></a>使用 indexOf 或 includes 加新数组</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> uniqueArr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;arr.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="comment">// if (!uniqueArr.includes(arr[i])) &#123;</span></span><br><span class="line">            <span class="comment">//includes 检测数组是否有某个值</span></span><br><span class="line">        <span class="keyword">if</span>(uniqueArr.<span class="title function_">indexOf</span>(arr[i])=== -<span class="number">1</span>)&#123;</span><br><span class="line">             <span class="comment">//indexof返回-1表示在新数组中不存在该元素</span></span><br><span class="line">             uniqueArr.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="sort-排序后，使用快慢指针的思想"><a href="#sort-排序后，使用快慢指针的思想" class="headerlink" title="sort 排序后，使用快慢指针的思想"></a>sort 排序后，使用快慢指针的思想</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    arr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a-b);<span class="comment">//升序排序</span></span><br><span class="line">    <span class="keyword">let</span> slow = <span class="number">1</span>,fast =<span class="number">1</span>;<span class="comment">//快慢指针起始点都是第二个</span></span><br><span class="line">    <span class="keyword">while</span>(fast&lt;arr.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[fast] !== arr[fast-<span class="number">1</span>])&#123;</span><br><span class="line">            arr[slow++] = arr[fast];</span><br><span class="line">        &#125;</span><br><span class="line">        fast++;</span><br><span class="line">    &#125;</span><br><span class="line">    arr.<span class="property">length</span> = slow;<span class="comment">// 去重后数组长度,原数组多余部分会被删除</span></span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sort 方法用于从小到大排序(返回一个新数组)，其参数中不带以上回调函数就会在两位数及以上时出现排序错误(如果省略，元素按照转换为的字符串的各个字符的 Unicode 位点进行排序。两位数会变为长度为二的字符串来计算)。</p>
<h2 id="ES6-提供的-Set-去重"><a href="#ES6-提供的-Set-去重" class="headerlink" title="ES6 提供的 Set 去重"></a>ES6 提供的 Set 去重</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * set 集合</span></span><br><span class="line"><span class="comment"> * 成员的值都是唯一的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Set</span>(arr);</span><br><span class="line">    <span class="comment">//通过扩展运算符拆分再放入数组中</span></span><br><span class="line">    <span class="keyword">return</span> [...res];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Set 中的元素只会出现一次，即 Set 中的元素是唯一的。</p>
<h2 id="使用哈希表存储元素是否出现-ES6-提供的-map"><a href="#使用哈希表存储元素是否出现-ES6-提供的-map" class="headerlink" title="使用哈希表存储元素是否出现(ES6 提供的 map)"></a>使用哈希表存储元素是否出现(ES6 提供的 map)</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * map 集合</span></span><br><span class="line"><span class="comment"> * 保存键值对，与对象类似,键可以是任意类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">const</span> uniqueArr= <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;arr.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!map.<span class="title function_">has</span>(arr[i]))&#123;</span><br><span class="line">            map.<span class="title function_">set</span>(arr[i],<span class="literal">true</span>);</span><br><span class="line">            uniqueArr.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uniqueArr; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>map 对象保存键值对，与对象类似。但 map 的键可以是任意类型，对象的键只能是字符串类型。</p>
<p>如果数组中只有数字也可以使用普通对象作为哈希表。</p>
<h2 id="filter-配合-indexOf"><a href="#filter-配合-indexOf" class="headerlink" title="filter 配合 indexOf"></a>filter 配合 indexOf</h2><p>filter返回过滤后的数组。filter也接收一个函数作为参数，这个函数将作用于数组中的每个元素，根据该函数每次执行后返回的布尔值来保留结果，如果是true就保留，如果是false就过滤掉。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">item,index,arr</span>) =&gt;</span> arr.<span class="title function_">indexOf</span>(item)===index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>indexOf返回元素在数组中第一次出现的位置</p>
<h2 id="reduce-配合-includes"><a href="#reduce-配合-includes" class="headerlink" title="reduce 配合 includes"></a>reduce 配合 includes</h2><p>reduce也是返回一个全新的数组。reduce接受一个函数作为参数，这个函数要有两个形参，代表数组中的前两项，reduce会将这个函数的结果与数组中的第三项再次组成这个函数的两个形参以此类推进行累积操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unique</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> uniqueArr = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">res,cur</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!res.<span class="title function_">includes</span>(cur))res.<span class="title function_">push</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,[])<span class="comment">// []作为回调函数的第一个参数的初始值</span></span><br><span class="line">    <span class="keyword">return</span> uniqueArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="如何实现数组扁平化"><a href="#如何实现数组扁平化" class="headerlink" title="如何实现数组扁平化"></a>如何实现数组扁平化</h1><p>数组扁平化就是把多维数组转化成一维数组。</p>
<h2 id="ES6提供的新方法-flat-depth"><a href="#ES6提供的新方法-flat-depth" class="headerlink" title="ES6提供的新方法 flat(depth)"></a>ES6提供的新方法 flat(depth)</h2><p>不会改变原数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,[<span class="number">2</span>,<span class="number">3</span>,[<span class="number">4</span>,[<span class="number">5</span>]]]];  </span><br><span class="line">a = a.<span class="title function_">flat</span>(<span class="number">4</span>-<span class="number">1</span>); <span class="comment">// [1,2,3,4,5]  a是4维数组</span></span><br><span class="line">a = a.<span class="title function_">flat</span>(<span class="title class_">Infinity</span>); <span class="comment">// [1,2,3,4,5]  a是4维数组</span></span><br></pre></td></tr></table></figure>

<h2 id="reduce方法-递归"><a href="#reduce方法-递归" class="headerlink" title="reduce方法 递归"></a>reduce方法 递归</h2><p>这里使用的是数组的reduce方法，需要注意的是reduce方法，我们传递了两个参数，<br>第一个参数就是就是处理扁平化的箭头函数<br>第二个参数是一个空数组，也是作为遍历的开始。（res）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flatten</span> = arr =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">res,next</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(next)?<span class="title function_">flatten</span>(next):next);</span><br><span class="line"></span><br><span class="line">    &#125;,[])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="为什么要使用深拷贝？"><a href="#为什么要使用深拷贝？" class="headerlink" title="为什么要使用深拷贝？"></a><strong>为什么要使用深拷贝？</strong></h1><p>因为希望在改变新的数组或对象时，不改变原数组或原对象。</p>
<p>深拷贝和浅拷贝是只针对非null的Object和Array这样的引用数据类型的。</p>
<p>深拷贝和浅拷贝的示意图大致如下：</p>
<p><img src="1.png" alt="1684286684266"></p>
<h2 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h2><p>只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。</p>
<h3 id="手动实现"><a href="#手动实现" class="headerlink" title="手动实现"></a>手动实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shallowcopy</span>(<span class="params">source</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (source) == <span class="string">&#x27;object&#x27;</span> &amp;&amp; source != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> newsource = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(source) ? [] : &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">            <span class="keyword">if</span> (source.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">                newsource[key] = source[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newsource</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> source</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> source = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> newsource = <span class="title function_">shallowcopy</span>(source);</span><br><span class="line">newsource[<span class="number">0</span>] = <span class="number">5</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(source, newsource)</span><br></pre></td></tr></table></figure>

<h3 id="浅拷贝方法"><a href="#浅拷贝方法" class="headerlink" title="浅拷贝方法"></a>浅拷贝方法</h3><ul>
<li>Object.assign()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123; name: &#x27;sy&#x27;, age: 18 &#125;;</span><br><span class="line">const obj2 = Object.assign(&#123;&#125;, obj, &#123;name: &#x27;sss&#x27;&#125;);</span><br><span class="line">console.log(obj2);//&#123; name: &#x27;sss&#x27;, age: 18 &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>concat</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = arr.<span class="title function_">concat</span>();</span><br><span class="line">newArr[<span class="number">1</span>] = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);<span class="comment">//[ 1, 2, 3 ]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>slice</li>
<li>…展开运算符</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = [...arr];<span class="comment">//跟arr.slice()是一样的效果</span></span><br></pre></td></tr></table></figure>

<h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><h3 id="手写深拷贝"><a href="#手写深拷贝" class="headerlink" title="手写深拷贝"></a>手写深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简易版本</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deepClone</span> = source =&gt;&#123;</span><br><span class="line">    <span class="comment">// 判断是否为数组</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">isArray</span> = arr =&gt; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(arr) === <span class="string">&#x27;[object Array]&#x27;</span>;</span><br><span class="line">    <span class="comment">// 判断是否为引用类型</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span>);</span><br><span class="line">    <span class="comment">//拷贝（递归）</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">copy</span> = input =&gt;&#123;</span><br><span class="line">        <span class="comment">// 当输入为函数或基本数据类型时，直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">&#x27;function&#x27;</span> || !<span class="title function_">isObject</span>(input)) <span class="keyword">return</span> input;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> output = <span class="title function_">isArray</span>(input) ? [] : &#123;&#125; ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> input)&#123;</span><br><span class="line">             <span class="comment">// 如果key是对象的自有属性</span></span><br><span class="line">            <span class="keyword">if</span>(input.<span class="title function_">hasOwnProperty</span>(key))&#123;</span><br><span class="line">                <span class="comment">// 递归调用深拷贝方法</span></span><br><span class="line">                output[key] = <span class="title function_">copy</span>(input[key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">copy</span>(source);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, &#123;<span class="attr">val</span>: <span class="number">4</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> newArr1 = <span class="title function_">deepClone</span>(arr);<span class="comment">//深拷贝</span></span><br><span class="line">newArr1[<span class="number">2</span>].<span class="property">val</span> = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">let</span> newArr2 = newArr1.<span class="title function_">slice</span>();<span class="comment">//浅拷贝</span></span><br><span class="line">newArr2[<span class="number">2</span>].<span class="property">val</span> = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);<span class="comment">//[ 1, 2, &#123; val: 1000 &#125; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArr1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArr2)</span><br></pre></td></tr></table></figure>

<h3 id="循环引用的问题"><a href="#循环引用的问题" class="headerlink" title="循环引用的问题"></a>循环引用的问题</h3><p>使用WeakMap解决</p>
<p>首先，Map 的键属于强引用，而 WeakMap 的键则属于弱引用。且 WeakMap 的键必须是对象，WeakMap 的值则是任意的。</p>
<p>由于它们的键与值的引用关系，决定了 Map 不能确保其引用的对象不会被垃圾回收器回收的引用。假设我们使用的 Map，那么图中的 foo 对象和我们深拷贝内部的 const map = new Map() 创建的 map 对象一直都是强引用关系，那么在程序结束之前，foo 不会被回收，其占用的内存空间一直不会被释放。</p>
<p>相比之下，原生的 WeakMap 持有的是每个键对象的“弱引用”，这意味着在没有其他引用存在时垃圾回收能正确进行。原生 WeakMap 的结构是特殊且有效的，其用于映射的 key 只有在其没有被回收时才是有效的。</p>
<p>基本上，如果你要往对象上添加数据，又不想干扰垃圾回收机制，就可以使用 WeakMap。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">deepCopy</span> = source =&gt; &#123;</span><br><span class="line">  <span class="comment">// 其他一样，省略一万字...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个数组，将每次拷贝的对象放进去</span></span><br><span class="line">  <span class="keyword">const</span> copiedArr = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拷贝（递归思路）</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">copy</span> = input =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当输入为函数或基本数据类型时，直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> input === <span class="string">&#x27;function&#x27;</span> || !<span class="title function_">isObject</span>(input)) <span class="keyword">return</span> input;   </span><br><span class="line">    <span class="comment">// 循环遍历，若有已拷贝过的对象，则直接放回，以解决循环引用的问题</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = copiedArr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (input === copiedArr[i].<span class="property">key</span>) <span class="keyword">return</span> copiedArr[i].<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> output = <span class="title function_">isArray</span>(input) ? [] : &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录每一次的对象</span></span><br><span class="line">    copiedArr.<span class="title function_">push</span>(&#123; <span class="attr">key</span>: input, <span class="attr">value</span>: output &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后面的流程不变...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">copy</span>(source)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/30/%E6%89%8B%E5%86%99%E6%BA%90%E4%BB%A3%E7%A0%81/" data-id="clm52imw3000zc4wp7208h6n8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-组件化、模块化、工程化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/05/30/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/" class="article-date">
  <time datetime="2023-05-30T02:13:36.000Z" itemprop="datePublished">2023-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/05/30/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/">组件化、模块化、工程化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是前端工程化、模块化、组件化？"><a href="#什么是前端工程化、模块化、组件化？" class="headerlink" title="什么是前端工程化、模块化、组件化？"></a>什么是前端工程化、模块化、组件化？</h1><h1 id="前端工程化"><a href="#前端工程化" class="headerlink" title="前端工程化"></a>前端工程化</h1><p>工程化是一种思想而不是某种技术(当然为了实现工程化我们会用一些技术)</p>
<p>再用一句通俗的话来概括前端工程化:前端工程化就是用做工程的思维看待和开发自己的项目,而不再是直接撸起袖子一个页面一个页面开写。</p>
<h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><p>开发时，我们会使用框架（React、Vue），ES6 模块化语法，Less/Sass 等 css 预处理器等语法进行开发。</p>
<p>这样的代码要想在浏览器运行必须经过编译成浏览器能识别的 JS、Css 等语法，才能运行。</p>
<p>所以我们需要打包工具帮我们做完这些事。</p>
<p>除此之外，打包工具还能压缩代码、做兼容性处理、提升代码性能等。</p>
<p>目前市面上最流量的是 Webpack，所以我们主要以 Webpack 来介绍使用打包工具</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>Webpack 是一个静态资源打包工具。</p>
<p>它会以一个或多个文件作为打包的入口，将我们整个项目所有文件编译组合成一个或多个文件输出出去。</p>
<p>输出的文件就是编译好的文件，就可以在浏览器段运行了。</p>
<p>我们将 Webpack 输出的文件叫做 bundle。</p>
<p><img src="webpack.png" alt="1685413462273"></p>
<p><strong>功能介绍</strong></p>
<p>Webpack 本身功能是有限的:</p>
<p>开发模式：仅能编译 JS 中的 ES Module 语法<br>生产模式：能编译 JS 中的 ES Module 语法，还能压缩 JS 代码</p>
<p><strong>开始使用</strong></p>
<ol>
<li>资源目录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webpack_code <span class="comment"># 项目根目录（所有指令必须在这个目录运行）</span></span><br><span class="line">    └── src <span class="comment"># 项目源码目录</span></span><br><span class="line">        ├── js <span class="comment"># js文件目录</span></span><br><span class="line">        │   ├── count.js</span><br><span class="line">        │   └── sum.js</span><br><span class="line">        └── main.js <span class="comment"># 项目主文件</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建文件</li>
</ol>
<p>count.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x - y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sum.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, c</span>) =&gt;</span> p + c, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>下载依赖</li>
</ol>
<p>打开终端，来到项目根目录。运行以下指令：</p>
<ul>
<li>初始化package.json</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>此时会生成一个基础的 package.json 文件。</p>
<p>需要注意的是 package.json 中 name 字段不能叫做 webpack, 否则下一步会报错</p>
<ul>
<li>下载依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启用 Webpack</li>
</ol>
<p>开发模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=development</span><br></pre></td></tr></table></figure>

<p>生产模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=production</span><br></pre></td></tr></table></figure>

<p><code>npx webpack:</code> 是用来运行本地安装 Webpack 包的。</p>
<p><code>./src/main.js:</code> 指定 Webpack 从 main.js 文件开始打包，不但会打包 main.js，还会将其依赖也一起打包进来。</p>
<p><code>--mode=xxx:</code> 指定模式（环境）。</p>
<ol start="5">
<li>观察输出文件</li>
</ol>
<p>默认 Webpack 会将文件打包输出到 dist 目录下，我们查看 dist 目录下文件情况就好了</p>
<p><strong>小结</strong><br>Webpack 本身功能比较少，只能处理 js 资源，一旦遇到 css 等其他资源就会报错。</p>
<p>所以我们学习 Webpack，就是主要学习如何处理其他资源。</p>
<h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>在开始使用 Webpack 之前，我们需要对 Webpack 的配置有一定的认识。</p>
<h4 id="5-大核心概念"><a href="#5-大核心概念" class="headerlink" title="5 大核心概念"></a>5 大核心概念</h4><p><code>entry</code>（入口）</p>
<p>指示 Webpack 从哪个文件开始打包</p>
<p><code>output</code>（输出）</p>
<p>指示 Webpack 打包完的文件输出到哪里去，如何命名等</p>
<p><code>loader</code>（加载器）</p>
<p>webpack 本身只能处理 js、json 等资源，其他资源需要借助 loader，Webpack 才能解析</p>
<p><code>plugins</code>（插件）</p>
<p>扩展 Webpack 的功能</p>
<p><code>mode</code>（模式）</p>
<p>主要由两种模式：</p>
<p>开发模式：development</p>
<p>生产模式：production</p>
<p>准备 Webpack 配置文件<br>在项目根目录下新建文件：<code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Webpack 是基于 Node.js 运行的，所以采用 Common.js 模块化规范</p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><ul>
<li>配置文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js的核心模块，专门用来处理文件路径</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="comment">// 相对路径和绝对路径都行</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// path: 文件输出目录，必须是绝对路径</span></span><br><span class="line">    <span class="comment">// path.resolve()方法返回一个绝对路径</span></span><br><span class="line">    <span class="comment">// __dirname 当前文件的文件夹绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">// filename: 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>运行指令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>此时功能和之前一样，也不能处理样式资源。</p>
<p>需要配置loader解析资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">	<span class="comment">// 用来处理图片资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">	<span class="comment">// 用来处理图标字体资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>Webpack 将来都通过 webpack.config.js 文件进行配置，来增强 Webpack 的功能</p>
<h2 id="webpack打包流程"><a href="#webpack打包流程" class="headerlink" title="webpack打包流程"></a>webpack打包流程</h2><p>1）webpack 从项目的 <code>entry</code>入口文件开始递归分析，调用所有配置的 <code>loader</code>对模块进行编译</p>
<p>因为 webpack 默认只能识别 js 代码，所以如 css 文件、.vue 结尾的文件，必须要通过对应的 loader 解析成 js 代码后，webpack 才能识别</p>
<p>2）利用 <code>babel(babylon)</code>将 js 代码转化为 <code>ast抽象语法树</code>，然后通过 <code>babel-traverse</code>对 ast 进行遍历</p>
<p>3）遍历的目的找到文件的 <code>import引用节点</code></p>
<p>因为现在我们引入文件都是通过 import 的方式引入，所以找到了 import 节点，就找到了文件的依赖关系</p>
<p>4）同时每个模块生成一个唯一的 id，并将解析过的 <code>模块缓存</code>起来，如果其他地方也引入该模块，就无需重新解析，最后根据依赖关系生成依赖图谱</p>
<p>5）递归遍历所有依赖图谱的模块，组装成一个个包含多个模块的 <code>Chunk(块)</code></p>
<p>6）最后将生成的文件输出到 <code>output</code> 的目录中</p>
<h1 id="前端模块化"><a href="#前端模块化" class="headerlink" title="前端模块化"></a>前端模块化</h1><p>前端工程化是一个高层次的思想,而模块化和组件化是为工程化思想下相对较具体的开发方式,因此可以简单的认为模块化和组件化是工程化的表现形式。</p>
<p>模块化开发，<strong>一个模块就是一个实现特定功能的文件，有了模块我们就可以更方便的使用别人的代码，要用什么功能就加载什么模块。</strong></p>
<p><strong>模块化开发的4点好处：</strong></p>
<ul>
<li>避免变量污染，命名冲突</li>
<li>提高代码复用率</li>
<li>提高维护性</li>
<li>依赖关系的管理</li>
</ul>
<p>那具体什么是模块化呢？还是举简单的例子,我们要写一个实现A功能的JS代码,这个功能在项目其他位置也需要用到,那么我们就可以把这个功能看成一个模块采用一定的方式进行模块化编写,既能实现复用还可以分而治之,同理在写样式的时候,如果我们需要某种特殊的样式,会在很多地方应用,那么我们也可以采用一定的方式进行CSS的模块化,具体说来,JS模块化方案很多有AMD/CommonJS/UMD/ES6 Module等,CSS模块化开发大多是在less、sass、stylus等预处理器的import/mixin特性支持下实现的</p>
<p>总体而言,<strong>模块化不难理解,重点是要学习相关的技术并且灵活运用。</strong></p>
<h1 id="前端组件化"><a href="#前端组件化" class="headerlink" title="前端组件化"></a>前端组件化</h1><p>组件化也是工程化的表现形式。</p>
<p>①页面上的每个独立的、可视/可交互区域视为一个组件;<br>②每个组件对应一个工程目录,组件所需的各种资源都在这个目录下就近维护;<br>③由于组件具有独立性,因此组件与组件之间可以 自由组合;<br>④页面只不过是组件的容器,负责组合组件形成功能完整的界面;<br>⑤当不需要某个组件,或者想要替换组件时,可以整个目录删除/替换。</p>
<p><strong>组件化将页面视为一个容器,页面上各个独立部分例如:头部、导航、焦点图、侧边栏、底部等视为独立组件,不同的页面根据内容的需要,去盛放相关组件即可组成完整的页面。</strong></p>
<p> <strong>PS:</strong> 模块化和组件化一个最直接的好处就是复用,同时我们也应该有一个理念,模块化和组件化除了复用之外还有就是分治,我们能够在不影响其他代码的情况下按需修改某一独立的模块或是组件,因此很多地方我们及时没有很强烈的复用需要也可以根据分治需求进行模块化或组件化开发。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/30/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/" data-id="clm52imw9001gc4wp7dae60kk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">组件化、模块化、工程化</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-图片懒加载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/20/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/" class="article-date">
  <time datetime="2023-04-20T13:13:08.000Z" itemprop="datePublished">2023-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/20/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/">图片懒加载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>懒加载经常出现在前端面试中，是前端性能优化的常用技巧。懒加载也叫延迟加载，把非关键资源先不加载，等用到了再加载，将加载非关键资源的时间推迟，而加快页面的初始加载时间。懒加载经常被用在图片、视频、音频、JavaScript 文件等资源加载上，本文主要讨论图片的懒加载。通过本文你能收获：</p>
<ul>
<li>图片懒加载的原理</li>
<li>实现图片懒加载的四种方案的原理以及优缺点</li>
<li>图片懒加载的一些优化</li>
</ul>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>图片懒加载的原理是没有在可视区域的图片暂时不加载图片，等进入可视区域后在加载图片，这样可以减少初始页面加载的图片数量而提升页面加载速度。<br>图片懒加载在提升页面加载速度的同时也会伴随用户看其他未展示的图片时会有等待时间；图片加载显示会伴有布局抖动等问题。</p>
<h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>图片懒加载的关键是：判断一个元素是否在可视区域。</p>
<h2 id="通过offsetTop来计算是否在可视区域内"><a href="#通过offsetTop来计算是否在可视区域内" class="headerlink" title="通过offsetTop来计算是否在可视区域内"></a>通过offsetTop来计算是否在可视区域内</h2><p>可视区域高度是 <code>document.documentElement.clientHeight</code> ，而可视区域的位置是在滚动条滚动位置 <code>scrollTop</code> 到 <code>scrollTop+document.documentElement.clientHeight</code>之间。因此通过 <code>image.offsetTop &lt;= document.documentElement.clientHeight + document.documentElement.scrollTop</code> 判断图片是否可以在可视区域内。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">lazyload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> lazyImages = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.lazyload&quot;</span>);</span><br><span class="line">      lazyImages.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">image</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( image.<span class="property">offsetTop</span> &lt;= <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> + <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollTop</span>) &#123;</span><br><span class="line">          image.<span class="property">src</span> = image.<span class="title function_">getAttribute</span>(<span class="string">&quot;data-src&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>添加滚动条监听。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="variable language_">window</span>.<span class="property">onscroll</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">lazyload</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>html结构。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;./default.gif&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;lazyload&quot;</span> data-src=<span class="string">&quot;./photo-1.jpg&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>上面只是简单的实现图片懒加载，在实际开发中还要很多细节需要优化：<br>首先是兼容性，这里有两个点涉及到兼容性：<code>document.documentElement.clientHeight</code> 和 <code>document.documentElement.scrollTop</code> 。<br>获取浏览器窗口的内部高度方法有 <code>window.innerHeight</code>、<code>document.documentElement.clientHeight</code>。<br><code>window.innerHeight</code>兼容性是 ie9+ 和其他主流浏览器。<code>document.documentElement.clientHeight</code> 浏览器都支持。</p>
<p>获取滚动位置方法有 <code>window.pageYOffset</code> 和 <code>document.documentElement.scrollTop</code> 。 <code>window.pageYOffset</code> 兼容性是 ie9+ 和其他主流浏览器。</p>
<p>第二优化点是offsetTop</p>
<blockquote>
<p>offsetParent 元素有滚动条的情况下计算会不会有问题?<strong>HTMLElement.offsetTop</strong> 为只读属性，它返回当前元素相对于其 offsetParent 元素的顶部内边距的距离</p>
</blockquote>
<p>offsetTop 是相对其 offsetParent 元素的并不是相对浏览器窗口可视区域的。如果图片元素有 offsetParent 那么 offsetTop 是有偏差的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getBoundingClientTop</span>(<span class="params">el</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> top = el.<span class="property">offsetTop</span>;</span><br><span class="line">  <span class="keyword">let</span> parent = el.<span class="property">offsetParent</span>;</span><br><span class="line">  <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">    top += parent.<span class="property">offsetTop</span>;</span><br><span class="line">    parent = parent.<span class="property">offsetParent</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> top;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三优化点避免赋值 src 。 代码是通过 lazyload 类获取需要懒加载的元素，这样会把之前已经加载图片的元素也获取到了，而重复设置 src属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">lazyload</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> lazyImages = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.lazyload[data-src]&quot;</span>);</span><br><span class="line">     lazyImages.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">image</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (</span><br><span class="line">         <span class="title function_">getBoundingClientTop</span>(image) &lt;=</span><br><span class="line">         <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> +</span><br><span class="line">           <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollTop</span></span><br><span class="line">       ) &#123;</span><br><span class="line">         image.<span class="property">src</span> = image.<span class="title function_">getAttribute</span>(<span class="string">&quot;data-src&quot;</span>);</span><br><span class="line">         image.<span class="title function_">removeAttribute</span>(<span class="string">&quot;data-src&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>通过 lazyload 类并且有 data-src 来获取元素，src 设置完后移除 data-src 属性来避免重复设置 src 。</p>
<p>第四优化点 onscroll 是否添加防抖。<br>onscroll 常用的优化点是加入防抖来减少事件触发的频率，但这里如果加了防抖，计算元素是否在可视区域内的精度就差很多，当滚动速度比较快的情况下加载反应不灵敏，这里就要找平衡点。</p>
<p>第五优化点页面中局部的 div 滚动图片懒加载。<br>除了整个页面的滚动图片懒加载，也有页面中局部滚动图片懒加载，就需要给制定的有滚动条 dom 元素绑定onscroll 事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">srcollDom.<span class="property">onscroll</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">lazyload</span>();</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>并且获取图片 top 是相对有滚动条 dom 元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getBoundingClientTop</span>(image)-<span class="title function_">getBoundingClientTop</span>(srcollDom) &lt;= srcollDom.<span class="property">clientHeight</span> + srcollDom.<span class="property">scrollTop</span></span><br></pre></td></tr></table></figure>

<p>第六优化点加载图片的时间点提前。<br>代码中是图片元素进入可视区域后才加载图片，用户就需要等待一段时间才能看到图片显示出来，如果把图片加载时间提前，图片元素距离可视区域一定范围内就加载图片，那么用户等待时间就会减少一些。</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>兼容性好，各个环节可以控制。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>性能相对不是很好，滚动事件频繁触发，并且获取元素的位置信息，可能会强行触发重排和重绘导致一定的性能消耗。</p>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="布局抖动"><a href="#布局抖动" class="headerlink" title="布局抖动"></a>布局抖动</h2><p>布局抖动是因为开始图片没有宽高，内容显示出来后有了宽高导致位置变动。带来的影响主要是用户体验不好，用户的注意力已经锁定了某个区域准备阅读，突然那个区域下移了，中断阅读而重新定位。可以直接在 img 标签上设置要加载图片的宽高。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;blank.gif&quot;</span> data-src=<span class="string">&quot;normal.jpg&quot;</span> style=<span class="string">&quot;width:800px;height:600px;&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="响应式图片"><a href="#响应式图片" class="headerlink" title="响应式图片"></a>响应式图片</h2><p>虽然响应式下图片的宽高会变，但是图片的宽高比是不变的，图片的宽高比变了图片也就变形了。所以 img 标签设定图片宽高比，就能根据不同视图的宽度算出不同高度。 先创建一个宽高比为 5:1 的 div。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;padding-bottom: 20%;background-color: green;&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>padding 为百分比是相对自身宽度的百分比。 然后再创建了一个宽高比为 5:1 的 img。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;padding-bottom: 20%;position: relative;&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute;width: 100%;height:100%&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>这样就能适应响应式的宽度改变，这种方式叫 Aspect Ratio Boxes。<br>占位图片可以设置成原图片的小尺寸图片，被放大后图片变模糊，这样开始加载小图片但图片的轮廓出现，后面在加载大图片显示清晰，给用户的体验是图片开始就在加载，然后加载完成就变清晰了。<br>img 标签 srcset 属性是处理响应式图片的。懒加载中可以设置 data-srcset 来延迟修改 srcset 属性。</p>
<h2 id="SEO不友好"><a href="#SEO不友好" class="headerlink" title="SEO不友好"></a>SEO不友好</h2><p><code>&lt;img&gt;</code> 标签中的 src 属性携带的仍然是原始大小的图片确保了站外 SEO、社会化分享、RSS 等不会读不到原图。Aspect Ratio Boxes 方式使占位图片适应响应式，srcset 属性存放了一张原图的小尺寸缩略图阻止 src 原图的加载而加载缩略图优化加载体验，最后延迟将 data-srcset 的值赋值到 srcset 中。</p>
<h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><ul>
<li><a href="https://link.juejin.cn/?target=https://github.com/tuupola/lazyload" title="https://github.com/tuupola/lazyload">lazyload.js</a><br>是 IntersectionObserver 方式，而且当浏览器不支持 IntersectionObserver 的时候就直接加载图片，没有延迟加载的功能。</li>
<li><a href="https://link.juejin.cn/?target=https://github.com/hilongjw/vue-lazyload" title="https://github.com/hilongjw/vue-lazyload">vue-lazyload</a><br>使用 IntersectionObserver 和 getBoundingClientRect 方式，默认 getBoundingClientRect 方式懒加载，里面的一些封装细节有很多有意思的地方，不止绑定了 onscroll 事件还绑定了 ‘onwheel’、’onmousewheel’、’onresize’、 ‘onanimationend’、’ontransitionend’、’ontouchmove’问什么要绑定这么多事件，插件为什么默认 getBoundingClientRect 方式而不用 IntersectionObserver 方式。</li>
<li><a href="https://link.juejin.cn/?target=https://github.com/twobin/react-lazyload" title="https://github.com/twobin/react-lazyload">react-lazyload</a><br>只用了 getBoundingClientRect 方式。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/20/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/" data-id="clm52imw2000tc4wpcmgvcz1w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ts/" rel="tag">ts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/" rel="tag">商城项目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">组件化、模块化、工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="tag">网络基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB/" rel="tag">网络攻击</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JS/" style="font-size: 20px;">JS</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/ts/" style="font-size: 10px;">ts</a> <a href="/tags/%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/" style="font-size: 10px;">商城项目</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 15px;">框架</a> <a href="/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 10px;">组件化、模块化、工程化</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">网络基础</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB/" style="font-size: 10px;">网络攻击</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/30/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93/">浏览器渲染</a>
          </li>
        
          <li>
            <a href="/2023/08/13/typescript/">typescript</a>
          </li>
        
          <li>
            <a href="/2023/06/02/MongoDB/">MongoDB</a>
          </li>
        
          <li>
            <a href="/2023/06/02/express%E6%A1%86%E6%9E%B6/">express框架</a>
          </li>
        
          <li>
            <a href="/2023/06/02/%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6/">会话控制</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>